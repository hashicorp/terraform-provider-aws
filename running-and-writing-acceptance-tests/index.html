
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Contributor documentation and reference for the Terraform AWS Provider">
      
      
      
      
        <link rel="prev" href="../documentation-changes/">
      
      
        <link rel="next" href="../unit-tests/">
      
      <link rel="icon" href="../images/hashicorp-black.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Acceptance Tests - Terraform AWS Provider - Contributor Guide</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="hashicorp" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-and-writing-acceptance-tests" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Terraform AWS Provider - Contributor Guide" class="md-header__button md-logo" aria-label="Terraform AWS Provider - Contributor Guide" data-md-component="logo">
      
  <img src="../images/hashicorp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Terraform AWS Provider - Contributor Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Acceptance Tests
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hashicorp/terraform-provider-aws" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hashicorp/terraform-provider-aws
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Terraform AWS Provider - Contributor Guide" class="md-nav__button md-logo" aria-label="Terraform AWS Provider - Contributor Guide" data-md-component="logo">
      
  <img src="../images/hashicorp.png" alt="logo">

    </a>
    Terraform AWS Provider - Contributor Guide
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hashicorp/terraform-provider-aws" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hashicorp/terraform-provider-aws
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="true">
          Contribute
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contribute" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Contribute
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../development-environment/" class="md-nav__link">
        Development Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" tabindex="0" aria-expanded="false">
          Contribution Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contribution Guides" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Contribution Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-a-new-resource/" class="md-nav__link">
        Resource
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-a-new-service/" class="md-nav__link">
        Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-a-new-datasource/" class="md-nav__link">
        Data source
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-a-new-ephemeral-resource/" class="md-nav__link">
        Ephemeral Resource
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-a-new-function/" class="md-nav__link">
        Function
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-a-new-region/" class="md-nav__link">
        AWS Region
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../add-import-support/" class="md-nav__link">
        Import Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resource-filtering/" class="md-nav__link">
        Resource Filtering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resource-name-generation/" class="md-nav__link">
        Resource Name Generation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resource-tagging/" class="md-nav__link">
        Resource Tagging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../adding-a-tag-resource/" class="md-nav__link">
        Tag Resource
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bugs-and-enhancements/" class="md-nav__link">
        Bugs and Enhancements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../documentation-changes/" class="md-nav__link">
        Documentation Changes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Acceptance Tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Acceptance Tests
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#in-context" class="md-nav__link">
    In context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acceptance-tests-often-cost-money-to-run" class="md-nav__link">
    Acceptance Tests Often Cost Money to Run
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-an-acceptance-test" class="md-nav__link">
    Running an Acceptance Test
  </a>
  
    <nav class="md-nav" aria-label="Running an Acceptance Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-cross-account-tests" class="md-nav__link">
    Running Cross-Account Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-cross-region-tests" class="md-nav__link">
    Running Cross-Region Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-only-short-tests" class="md-nav__link">
    Running Only Short Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-an-acceptance-test" class="md-nav__link">
    Writing an Acceptance Test
  </a>
  
    <nav class="md-nav" aria-label="Writing an Acceptance Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anatomy-of-an-acceptance-test" class="md-nav__link">
    Anatomy of an Acceptance Test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-acceptance-testing" class="md-nav__link">
    Resource Acceptance Testing
  </a>
  
    <nav class="md-nav" aria-label="Resource Acceptance Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-configurations" class="md-nav__link">
    Test Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-configuration-independence" class="md-nav__link">
    Test Configuration Independence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-test-configurations" class="md-nav__link">
    Combining Test Configurations
  </a>
  
    <nav class="md-nav" aria-label="Combining Test Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-test-configurations" class="md-nav__link">
    Base Test Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-common-test-configurations" class="md-nav__link">
    Available Common Test Configurations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randomized-naming" class="md-nav__link">
    Randomized Naming
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-recommended-variables" class="md-nav__link">
    Other Recommended Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-acceptance-tests" class="md-nav__link">
    Basic Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prechecks" class="md-nav__link">
    PreChecks
  </a>
  
    <nav class="md-nav" aria-label="PreChecks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-provider-prechecks" class="md-nav__link">
    Standard Provider PreChecks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-prechecks" class="md-nav__link">
    Custom PreChecks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorchecks" class="md-nav__link">
    ErrorChecks
  </a>
  
    <nav class="md-nav" aria-label="ErrorChecks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-errorcheck" class="md-nav__link">
    Common ErrorCheck
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-specific-errorchecks" class="md-nav__link">
    Service-Specific ErrorChecks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-running-test-guards" class="md-nav__link">
    Long-Running Test Guards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disappears-acceptance-tests" class="md-nav__link">
    Disappears Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-attribute-acceptance-tests" class="md-nav__link">
    Per Attribute Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-account-acceptance-tests" class="md-nav__link">
    Cross-Account Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-region-acceptance-tests" class="md-nav__link">
    Cross-Region Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceptance-test-concurrency" class="md-nav__link">
    Acceptance Test Concurrency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-source-acceptance-testing" class="md-nav__link">
    Data Source Acceptance Testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acceptance-test-sweepers" class="md-nav__link">
    Acceptance Test Sweepers
  </a>
  
    <nav class="md-nav" aria-label="Acceptance Test Sweepers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-test-sweepers" class="md-nav__link">
    Running Test Sweepers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweeper-checklists" class="md-nav__link">
    Sweeper Checklists
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-test-sweepers" class="md-nav__link">
    Writing Test Sweepers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acceptance-test-checklists" class="md-nav__link">
    Acceptance Test Checklists
  </a>
  
    <nav class="md-nav" aria-label="Acceptance Test Checklists">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-acceptance-test-design" class="md-nav__link">
    Basic Acceptance Test Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-implementation" class="md-nav__link">
    Test Implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-hard-coding" class="md-nav__link">
    Avoid Hard Coding
  </a>
  
    <nav class="md-nav" aria-label="Avoid Hard Coding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardcoded-account-ids" class="md-nav__link">
    Hardcoded Account IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-ami-ids" class="md-nav__link">
    Hardcoded AMI IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-availability-zones" class="md-nav__link">
    Hardcoded Availability Zones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-database-versions" class="md-nav__link">
    Hardcoded Database Versions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-direct-connect-locations" class="md-nav__link">
    Hardcoded Direct Connect Locations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-instance-types" class="md-nav__link">
    Hardcoded Instance Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-partition-dns-suffix" class="md-nav__link">
    Hardcoded Partition DNS Suffix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-partition-in-arn" class="md-nav__link">
    Hardcoded Partition in ARN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-region" class="md-nav__link">
    Hardcoded Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-spot-price" class="md-nav__link">
    Hardcoded Spot Price
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-ssh-keys" class="md-nav__link">
    Hardcoded SSH Keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-email-addresses" class="md-nav__link">
    Hardcoded Email Addresses
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../unit-tests/" class="md-nav__link">
        Unit Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../continuous-integration/" class="md-nav__link">
        Continuous Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../changelog-process/" class="md-nav__link">
        Changelog Process
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../raising-a-pull-request/" class="md-nav__link">
        Raising a Pull Request
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../prioritization/" class="md-nav__link">
        How We Prioritize
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Developer Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Developer Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../acc-test-environment-variables/" class="md-nav__link">
        Acceptance Test Environment Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ai-agents/" class="md-nav__link">
        AI Agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" tabindex="0" aria-expanded="false">
          AI Agent Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="AI Agent Guides" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          AI Agent Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ai-agent-guides/arn-based-resource-identity/" class="md-nav__link">
        ARN-Based Resource Identity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ai-agent-guides/parameterized-resource-identity/" class="md-nav__link">
        Parameterized Resource Identity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ai-agent-guides/smarterr/" class="md-nav__link">
        Smarterr
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aws-sdk-go-base/" class="md-nav__link">
        AWS SDK Go Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-services/" class="md-nav__link">
        Core Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data-handling-and-conversion/" class="md-nav__link">
        Data Handling and Conversion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dependency-updates/" class="md-nav__link">
        Dependency Updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../design-decision-log/" class="md-nav__link">
        Design Decision Log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../enhanced-region-support/" class="md-nav__link">
        Enhanced Region Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../error-handling/" class="md-nav__link">
        Error Handling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../go-vcr/" class="md-nav__link">
        Go-VCR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../id-attributes/" class="md-nav__link">
        ID Attributes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../makefile-cheat-sheet/" class="md-nav__link">
        Makefile Cheat Sheet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../naming/" class="md-nav__link">
        Naming Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../provider-design/" class="md-nav__link">
        Provider Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../skaff/" class="md-nav__link">
        Provider Scaffolding (skaff)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regular-expressions/" class="md-nav__link">
        Regular Expressions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../retries-and-waiters/" class="md-nav__link">
        Retries and Waiters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-plugin-development-packages/" class="md-nav__link">
        Terraform Plugin Development Packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-plugin-migrations/" class="md-nav__link">
        Terraform Plugin Migrations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../issue-reporting-and-lifecycle/" class="md-nav__link">
        Submit an Issue
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#in-context" class="md-nav__link">
    In context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acceptance-tests-often-cost-money-to-run" class="md-nav__link">
    Acceptance Tests Often Cost Money to Run
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-an-acceptance-test" class="md-nav__link">
    Running an Acceptance Test
  </a>
  
    <nav class="md-nav" aria-label="Running an Acceptance Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-cross-account-tests" class="md-nav__link">
    Running Cross-Account Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-cross-region-tests" class="md-nav__link">
    Running Cross-Region Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-only-short-tests" class="md-nav__link">
    Running Only Short Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-an-acceptance-test" class="md-nav__link">
    Writing an Acceptance Test
  </a>
  
    <nav class="md-nav" aria-label="Writing an Acceptance Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anatomy-of-an-acceptance-test" class="md-nav__link">
    Anatomy of an Acceptance Test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-acceptance-testing" class="md-nav__link">
    Resource Acceptance Testing
  </a>
  
    <nav class="md-nav" aria-label="Resource Acceptance Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-configurations" class="md-nav__link">
    Test Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-configuration-independence" class="md-nav__link">
    Test Configuration Independence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-test-configurations" class="md-nav__link">
    Combining Test Configurations
  </a>
  
    <nav class="md-nav" aria-label="Combining Test Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-test-configurations" class="md-nav__link">
    Base Test Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-common-test-configurations" class="md-nav__link">
    Available Common Test Configurations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randomized-naming" class="md-nav__link">
    Randomized Naming
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-recommended-variables" class="md-nav__link">
    Other Recommended Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-acceptance-tests" class="md-nav__link">
    Basic Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prechecks" class="md-nav__link">
    PreChecks
  </a>
  
    <nav class="md-nav" aria-label="PreChecks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-provider-prechecks" class="md-nav__link">
    Standard Provider PreChecks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-prechecks" class="md-nav__link">
    Custom PreChecks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errorchecks" class="md-nav__link">
    ErrorChecks
  </a>
  
    <nav class="md-nav" aria-label="ErrorChecks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-errorcheck" class="md-nav__link">
    Common ErrorCheck
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-specific-errorchecks" class="md-nav__link">
    Service-Specific ErrorChecks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-running-test-guards" class="md-nav__link">
    Long-Running Test Guards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disappears-acceptance-tests" class="md-nav__link">
    Disappears Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#per-attribute-acceptance-tests" class="md-nav__link">
    Per Attribute Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-account-acceptance-tests" class="md-nav__link">
    Cross-Account Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-region-acceptance-tests" class="md-nav__link">
    Cross-Region Acceptance Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceptance-test-concurrency" class="md-nav__link">
    Acceptance Test Concurrency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-source-acceptance-testing" class="md-nav__link">
    Data Source Acceptance Testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acceptance-test-sweepers" class="md-nav__link">
    Acceptance Test Sweepers
  </a>
  
    <nav class="md-nav" aria-label="Acceptance Test Sweepers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-test-sweepers" class="md-nav__link">
    Running Test Sweepers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweeper-checklists" class="md-nav__link">
    Sweeper Checklists
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-test-sweepers" class="md-nav__link">
    Writing Test Sweepers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acceptance-test-checklists" class="md-nav__link">
    Acceptance Test Checklists
  </a>
  
    <nav class="md-nav" aria-label="Acceptance Test Checklists">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-acceptance-test-design" class="md-nav__link">
    Basic Acceptance Test Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-implementation" class="md-nav__link">
    Test Implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-hard-coding" class="md-nav__link">
    Avoid Hard Coding
  </a>
  
    <nav class="md-nav" aria-label="Avoid Hard Coding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardcoded-account-ids" class="md-nav__link">
    Hardcoded Account IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-ami-ids" class="md-nav__link">
    Hardcoded AMI IDs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-availability-zones" class="md-nav__link">
    Hardcoded Availability Zones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-database-versions" class="md-nav__link">
    Hardcoded Database Versions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-direct-connect-locations" class="md-nav__link">
    Hardcoded Direct Connect Locations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-instance-types" class="md-nav__link">
    Hardcoded Instance Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-partition-dns-suffix" class="md-nav__link">
    Hardcoded Partition DNS Suffix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-partition-in-arn" class="md-nav__link">
    Hardcoded Partition in ARN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-region" class="md-nav__link">
    Hardcoded Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-spot-price" class="md-nav__link">
    Hardcoded Spot Price
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-ssh-keys" class="md-nav__link">
    Hardcoded SSH Keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcoded-email-addresses" class="md-nav__link">
    Hardcoded Email Addresses
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<!-- markdownlint-configure-file { "code-block-style": false } -->
<h1 id="running-and-writing-acceptance-tests">Running and Writing Acceptance Tests<a class="headerlink" href="#running-and-writing-acceptance-tests" title="Permanent link">#</a></h1>
<p>Terraform includes an acceptance test harness that does most of the repetitive
work involved in testing a resource. For additional information about testing
Terraform Providers, see the <a href="https://www.terraform.io/plugin/sdkv2/testing">SDKv2 documentation</a>.</p>
<h2 id="in-context">In context<a class="headerlink" href="#in-context" title="Permanent link">#</a></h2>
<p>To help place acceptance testing in context, here is an overview of the Terraform AWS Provider's three types of tests.</p>
<ol>
<li><strong>Acceptance tests</strong> (<em>You are here!</em>) are end-to-end evaluations of interactions with AWS. They validate functionalities like creating, reading, and destroying resources within AWS.</li>
<li><a href="../unit-tests/"><strong>Unit tests</strong></a> focus on testing isolated units of code within the software, typically at the function level. They assess functionalities solely within the provider itself.</li>
<li><a href="../continuous-integration/"><strong>Continuous integration tests</strong></a> encompass a suite of automated tests that are executed on every pull request and include linting, compiling code, running unit tests, and performing static analysis.</li>
</ol>
<h2 id="acceptance-tests-often-cost-money-to-run">Acceptance Tests Often Cost Money to Run<a class="headerlink" href="#acceptance-tests-often-cost-money-to-run" title="Permanent link">#</a></h2>
<p>Our acceptance test suite creates real resources, and as a result, they cost real money to run.
Because the resources only exist for a short period of time, the total amount
of money required is usually relatively small. That said there are particular services
which are very expensive to run and it's important to be prepared for those costs.</p>
<p>Some services which can be cost-prohibitive include (among others):</p>
<ul>
<li>ACM (Amazon Certificate Manager)</li>
<li>Bedrock</li>
<li>EC2</li>
<li>ElastiCache</li>
<li>FSx</li>
<li>Glue</li>
<li>Kinesis Analytics</li>
<li>OpenSearch</li>
<li>RDS</li>
<li>Storage Gateway</li>
<li>WorkSpaces</li>
</ul>
<p>We don't want financial limitations to be a barrier to contribution, so if you are unable to
pay to run acceptance tests for your contribution, mention this in your
pull request. We will happily accept "best effort" implementations of
acceptance tests and run them for you on our side. This might mean that your PR
takes a bit longer to merge, but it most definitely is not a blocker for
contributions.</p>
<h2 id="running-an-acceptance-test">Running an Acceptance Test<a class="headerlink" href="#running-an-acceptance-test" title="Permanent link">#</a></h2>
<p>Acceptance tests can be run using the <code>testacc</code> target in the Terraform
<code>Makefile</code>. The individual tests to run can be controlled using a regular
expression. Prior to running the tests provider configuration details such as
access keys must be made available as environment variables.</p>
<p>For example, to run an acceptance test against the Amazon Web Services
provider, the following environment variables must be set:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Using a profile</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_PROFILE</span><span class="o">=</span>...
<span class="c1"># Otherwise</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>...
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>...
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>...
</code></pre></div>
<p>Please note that the default region for the testing is <code>us-west-2</code> and must be
overridden via the <code>AWS_DEFAULT_REGION</code> environment variable, if necessary. This
is especially important for testing AWS GovCloud (US), which requires:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>us-gov-west-1
</code></pre></div>
<p>Tests can then be run by specifying a regular expression defining the tests to
run and the package in which the tests are defined:</p>
<div class="highlight"><pre><span></span><code><span class="go">make testacc TESTS=TestAccCloudWatchDashboard_updateName PKG=cloudwatch</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>==&gt; Checking that code complies with gofmt requirements...
TF_ACC=1 go test ./internal/service/cloudwatch/... -v -count 1 -parallel 20 -run=TestAccCloudWatchDashboard_updateName -timeout 180m
=== RUN   TestAccCloudWatchDashboard_updateName
=== PAUSE TestAccCloudWatchDashboard_updateName
=== CONT  TestAccCloudWatchDashboard_updateName
--- PASS: TestAccCloudWatchDashboard_updateName (25.33s)
PASS
ok      github.com/hashicorp/terraform-provider-aws/internal/service/cloudwatch 25.387s
</code></pre></div>
<p>Entire resource test suites can be targeted by using the naming convention to
write the regular expression. For example, to run all tests of the
<code>aws_cloudwatch_dashboard</code> resource rather than just the <code>updateName</code> test, you
can start testing like this:</p>
<div class="highlight"><pre><span></span><code><span class="go">make testacc TESTS=TestAccCloudWatchDashboard PKG=cloudwatch</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>==&gt; Checking that code complies with gofmt requirements...
TF_ACC=1 go test ./internal/service/cloudwatch/... -v -count 1 -parallel 20 -run=TestAccCloudWatchDashboard -timeout 180m
=== RUN   TestAccCloudWatchDashboard_basic
=== PAUSE TestAccCloudWatchDashboard_basic
=== RUN   TestAccCloudWatchDashboard_update
=== PAUSE TestAccCloudWatchDashboard_update
=== RUN   TestAccCloudWatchDashboard_updateName
=== PAUSE TestAccCloudWatchDashboard_updateName
=== CONT  TestAccCloudWatchDashboard_basic
=== CONT  TestAccCloudWatchDashboard_updateName
=== CONT  TestAccCloudWatchDashboard_update
--- PASS: TestAccCloudWatchDashboard_basic (15.83s)
--- PASS: TestAccCloudWatchDashboard_updateName (26.69s)
--- PASS: TestAccCloudWatchDashboard_update (27.72s)
PASS
ok      github.com/hashicorp/terraform-provider-aws/internal/service/cloudwatch 27.783s
</code></pre></div>
<p>Running acceptance tests requires version 0.12.26 or higher of the Terraform CLI to be installed.</p>
<p>For advanced developers, the acceptance testing framework accepts some additional environment variables that can be used to control Terraform CLI binary selection, logging, and other behaviors. See the <a href="https://www.terraform.io/plugin/sdkv2/testing/acceptance-tests#environment-variables">SDKv2 documentation</a> for more information.</p>
<p>Please Note: On macOS 10.14 and later (and some Linux distributions), the default user open file limit is 256. This may cause unexpected issues when running the acceptance testing since this can prevent various operations from occurring such as opening network connections to AWS. To view this limit, the <code>ulimit -n</code> command can be run. To update this limit, run <code>ulimit -n 1024</code>  (or higher).</p>
<h3 id="running-cross-account-tests">Running Cross-Account Tests<a class="headerlink" href="#running-cross-account-tests" title="Permanent link">#</a></h3>
<p>Certain testing requires multiple AWS accounts. This additional setup is not typically required and the testing will return an error (shown below) if your current setup does not have the secondary AWS configuration:</p>
<div class="highlight"><pre><span></span><code><span class="go">make testacc TESTS=TestAccRDSInstance_DBSubnetGroupName_ramShared PKG=rds</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>TF_ACC=1 go test ./internal/service/rds/... -v -count 1 -parallel 20 -run=TestAccRDSInstance_DBSubnetGroupName_ramShared -timeout 180m
=== RUN   TestAccRDSInstance_DBSubnetGroupName_ramShared
=== PAUSE TestAccRDSInstance_DBSubnetGroupName_ramShared
=== CONT  TestAccRDSInstance_DBSubnetGroupName_ramShared
    acctest.go:674: skipping test because at least one environment variable of [AWS_ALTERNATE_PROFILE AWS_ALTERNATE_ACCESS_KEY_ID] must be set. Usage: credentials for running acceptance testing in alternate AWS account.
--- SKIP: TestAccRDSInstance_DBSubnetGroupName_ramShared (0.85s)
PASS
ok      github.com/hashicorp/terraform-provider-aws/internal/service/rds        0.888s
</code></pre></div>
<p>Running these acceptance tests is the same as before, except the following additional AWS credential information is required:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Using a profile</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ALTERNATE_PROFILE</span><span class="o">=</span>...
<span class="c1"># Otherwise</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ALTERNATE_ACCESS_KEY_ID</span><span class="o">=</span>...
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ALTERNATE_SECRET_ACCESS_KEY</span><span class="o">=</span>...
</code></pre></div>
<h3 id="running-cross-region-tests">Running Cross-Region Tests<a class="headerlink" href="#running-cross-region-tests" title="Permanent link">#</a></h3>
<p>Certain testing requires multiple AWS regions. Additional setup is not typically required because the testing defaults the second AWS region to <code>us-east-1</code> and the third AWS region to <code>us-east-2</code>.</p>
<p>Running these acceptance tests is the same as before, but if you wish to override the second and third regions:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ALTERNATE_REGION</span><span class="o">=</span>...
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_THIRD_REGION</span><span class="o">=</span>...
</code></pre></div>
<h3 id="running-only-short-tests">Running Only Short Tests<a class="headerlink" href="#running-only-short-tests" title="Permanent link">#</a></h3>
<p>Some tests have been manually marked as long-running (longer than 300 seconds) and can be skipped using the <code>-short</code> flag. However, we are adding long-running guards little by little and many services have no guarded tests.</p>
<p>Where guards have been implemented, do not always skip long-running tests. However, for intermediate test runs during development, or to verify functionality unrelated to the specific long-running tests, skipping long-running tests makes work more efficient. We recommend that for the final test run before submitting a PR you run affected tests without the <code>-short</code> flag.</p>
<p>If you want to run only short-running tests, you can use either one of these equivalent statements. Note the use of <code>-short</code>.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="go">make testacc TESTS=&#39;TestAccECSTaskDefinition_&#39; PKG=ecs TESTARGS=-short</span>
</code></pre></div>
<p>Or:</p>
<div class="highlight"><pre><span></span><code><span class="go">TF_ACC=1 go test ./internal/service/ecs/... -v -count 1 -parallel 20 -run=&#39;TestAccECSTaskDefinition_&#39; -short -timeout 180m</span>
</code></pre></div>
<h2 id="writing-an-acceptance-test">Writing an Acceptance Test<a class="headerlink" href="#writing-an-acceptance-test" title="Permanent link">#</a></h2>
<p>Terraform has a framework for writing acceptance tests which minimizes the
amount of boilerplate code necessary to use common testing patterns. This guide is meant to augment the general <a href="https://www.terraform.io/plugin/sdkv2/testing/acceptance-tests">SDKv2 documentation</a> with Terraform AWS Provider specific conventions and helpers.</p>
<h3 id="anatomy-of-an-acceptance-test">Anatomy of an Acceptance Test<a class="headerlink" href="#anatomy-of-an-acceptance-test" title="Permanent link">#</a></h3>
<p>This section describes in detail how the Terraform acceptance testing framework operates with respect to the Terraform AWS Provider. We recommend those unfamiliar with this provider, or Terraform resource testing in general, take a look here first to generally understand how we interact with AWS and the resource code to verify functionality.</p>
<p>The entry point to the framework is the <code>resource.ParallelTest()</code> function. This wraps our testing to work with the standard Go testing framework, while also preventing unexpected usage of AWS by requiring the <code>TF_ACC=1</code> environment variable. This function accepts a <code>TestCase</code> parameter, which has all the details about the test itself. For example, this includes the test steps (<code>TestSteps</code>) and how to verify resource deletion in the API after all steps have been run (<code>CheckDestroy</code>).</p>
<p>Each <code>TestStep</code> proceeds by applying some
Terraform configuration using the provider under test, and then verifying that
results are as expected by making assertions using the provider API. It is
common for a single test function to exercise both the creation of and updates
to a single resource. Most tests follow a similar structure.</p>
<ol>
<li>Pre-flight checks are made to ensure that sufficient provider configuration
   is available to be able to proceed - for example in an acceptance test
   targeting AWS, <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> must be set prior
   to running acceptance tests. This is common to all tests exercising a single
   provider.</li>
</ol>
<p>Most assertion
functions are defined out of band with the tests. This keeps the tests
readable, and allows reuse of assertion functions across different tests of the
same type of resource. The definition of a complete test looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccCloudWatchDashboard_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">dashboard</span><span class="w"> </span><span class="nx">cloudwatch</span><span class="p">.</span><span class="nx">GetDashboardOutput</span>
<span class="w">    </span><span class="nx">rInt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">RandInt</span><span class="p">()</span>

<span class="w">    </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">        </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">                 </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">CloudWatchServiceID</span><span class="p">),</span>
<span class="w">        </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5ProviderFactories</span><span class="p">,</span>
<span class="w">        </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckDashboardDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccDashboardConfig</span><span class="p">(</span><span class="nx">rInt</span><span class="p">),</span>
<span class="w">                </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">                    </span><span class="nx">testAccCheckDashboardExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aws_cloudwatch_dashboard.foobar&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">dashboard</span><span class="p">),</span>
<span class="w">                    </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="s">&quot;aws_cloudwatch_dashboard.foobar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dashboard_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">testAccDashboardName</span><span class="p">(</span><span class="nx">rInt</span><span class="p">)),</span>
<span class="w">                </span><span class="p">),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>When executing the test, the following steps are taken for each <code>TestStep</code>:</p>
<ol>
<li>
<p>The Terraform configuration required for the test is applied. This is
   responsible for configuring the resource under test, and any dependencies it
   may have. For example, to test the <code>aws_cloudwatch_dashboard</code> resource, a valid configuration with the requisite fields is required. This results in a configuration which looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_dashboard&quot;</span><span class="w"> </span><span class="nv">&quot;foobar&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">dashboard_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-test-dashboard-%[1]d&quot;</span>
<span class="w">  </span><span class="na">dashboard_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span>
<span class="sh">  {</span>
<span class="sh">    &quot;widgets&quot;: [{</span>
<span class="sh">      &quot;type&quot;: &quot;text&quot;,</span>
<span class="sh">      &quot;x&quot;: 0,</span>
<span class="sh">      &quot;y&quot;: 0,</span>
<span class="sh">      &quot;width&quot;: 6,</span>
<span class="sh">      &quot;height&quot;: 6,</span>
<span class="sh">      &quot;properties&quot;: {</span>
<span class="sh">        &quot;markdown&quot;: &quot;Hi there from Terraform: CloudWatch&quot;</span>
<span class="sh">      }</span>
<span class="sh">    }]</span>
<span class="sh">  }</span>
<span class="dl">  EOF</span>
<span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Assertions are run using the provider API. These use the provider API
   directly rather than asserting against the resource state. For example, to
   verify that the <code>aws_cloudwatch_dashboard</code> described above was created
   successfully, a test function like this is used:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">testAccCheckDashboardExists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">dashboard</span><span class="w"> </span><span class="o">*</span><span class="nx">cloudwatch</span><span class="p">.</span><span class="nx">GetDashboardOutput</span><span class="p">)</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckFunc</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">State</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">rs</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">RootModule</span><span class="p">().</span><span class="nx">Resources</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Not found: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Provider</span><span class="p">.</span><span class="nx">Meta</span><span class="p">().(</span><span class="o">*</span><span class="nx">conns</span><span class="p">.</span><span class="nx">AWSClient</span><span class="p">).</span><span class="nx">CloudWatchConn</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nx">params</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cloudwatch</span><span class="p">.</span><span class="nx">GetDashboardInput</span><span class="p">{</span>
<span class="w">      </span><span class="nx">DashboardName</span><span class="p">:</span><span class="w"> </span><span class="nx">aws</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="nx">rs</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">ID</span><span class="p">),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">GetDashboardWithContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">params</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">*</span><span class="nx">dashboard</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">resp</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<p>Notice that the only information used from the Terraform state is the ID of
   the resource. For computed properties, we instead assert that the value saved in the Terraform state was the
   expected value if possible. The testing framework provides helper functions
   for several common types of checks - for example:</p>
<div class="highlight"><pre><span></span><code><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="s">&quot;aws_cloudwatch_dashboard.foobar&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dashboard_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">testAccDashboardName</span><span class="p">(</span><span class="nx">rInt</span><span class="p">)),</span>
</code></pre></div>
<ol>
<li>
<p>The resources created by the test are destroyed. This step happens
   automatically, and is the equivalent of calling <code>terraform destroy</code>.</p>
</li>
<li>
<p>Assertions are made against the provider API to verify that the resources
   have indeed been removed. If these checks fail, the test fails and reports
   "dangling resources". The code to ensure that the <code>aws_cloudwatch_dashboard</code> shown
   above has been destroyed looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">testAccCheckDashboardDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckFunc</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">State</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Provider</span><span class="p">.</span><span class="nx">Meta</span><span class="p">().(</span><span class="o">*</span><span class="nx">conns</span><span class="p">.</span><span class="nx">AWSClient</span><span class="p">).</span><span class="nx">CloudWatchConn</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">rs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">RootModule</span><span class="p">().</span><span class="nx">Resources</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;aws_cloudwatch_dashboard&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">continue</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">params</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cloudwatch</span><span class="p">.</span><span class="nx">GetDashboardInput</span><span class="p">{</span>
<span class="w">        </span><span class="nx">DashboardName</span><span class="p">:</span><span class="w"> </span><span class="nx">aws</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="nx">rs</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">ID</span><span class="p">),</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">GetDashboardWithContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">params</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Dashboard still exists: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">ID</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">isDashboardNotFoundErr</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
<p>These functions usually test only for the resource directly under test.</p>
<h3 id="resource-acceptance-testing">Resource Acceptance Testing<a class="headerlink" href="#resource-acceptance-testing" title="Permanent link">#</a></h3>
<p>Most resources that implement standard Create, Read, Update, and Delete functionality should follow the pattern below. Each test type has a section that describes them in more detail:</p>
<ul>
<li><strong>basic</strong>: This represents the bare minimum verification that the resource can be created, read, deleted, and optionally imported.</li>
<li><strong>disappears</strong>: A test that verifies Terraform will offer to recreate a resource if it is deleted outside of Terraform (e.g., via the Console) instead of returning an error that it cannot be found.</li>
<li><strong>Per Attribute</strong>: A test that verifies the resource with a single additional argument can be created, read, optionally updated (or force resource recreation), deleted, and optionally imported.</li>
</ul>
<p>The leading sections below highlight additional recommended patterns.</p>
<h4 id="test-configurations">Test Configurations<a class="headerlink" href="#test-configurations" title="Permanent link">#</a></h4>
<p>Most of the existing test configurations you will find in the Terraform AWS Provider are written in the following function-based style:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ... omitted for brevity ...</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingConfig</span><span class="p">(),</span>
<span class="w">        </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfig</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  # ... omitted for brevity ...</span>
<span class="s">}</span>
<span class="s">`</span>
<span class="p">}</span>
</code></pre></div>
<p>Even when no values need to be passed in to the test configuration, we have found this setup to be the most flexible for allowing that to be easily implemented. Any configurable values are handled via <code>fmt.Sprintf()</code>. Using <code>text/template</code> or other templating styles is explicitly forbidden.</p>
<p>For consistency, resources in the test configuration should be named <code>resource "..." "test"</code> unless multiple of that resource are necessary.</p>
<p>We discourage re-using test configurations across test files (except for some common configuration helpers we provide) as it is much harder to discover potential testing regressions.</p>
<p>Please also note that the newline on the first line of the configuration (before <code>resource</code>) and the newline after the last line of configuration (after <code>}</code>) are important to allow test configurations to be easily combined without generating Terraform configuration language syntax errors.</p>
<h4 id="test-configuration-independence">Test Configuration Independence<a class="headerlink" href="#test-configuration-independence" title="Permanent link">#</a></h4>
<p><em>Across the entire provider</em>, all test configurations should be as independent of each other as possible. For example, a common place this concept comes up is with the default VPC. Since we have tests that reconfigure the default VPC, if your configuration requires a VPC, it should not rely on the default VPC. Instead, include a VPC that will be created and destroyed as part of the test.</p>
<p>Make sure that your test configuration:</p>
<ol>
<li>Includes everything required for Terraform to run the test</li>
<li>Does not assume that any user-managed infrastructure will be in place, such as S3 buckets, IAM roles, KMS keys, VPCs, subnets, etc.</li>
</ol>
<h4 id="combining-test-configurations">Combining Test Configurations<a class="headerlink" href="#combining-test-configurations" title="Permanent link">#</a></h4>
<p>We include a helper function, <code>acctest.ConfigCompose()</code> for iteratively building and chaining test configurations together. It accepts any number of configurations to combine them. This simplifies a single resource's testing by allowing the creation of a "base" test configuration for all the other test configurations (if necessary) and also allows the maintainers to curate common configurations. Each of these is described in more detail in the below sections.</p>
<p>Please note that we do discourage <em>excessive</em> chaining of configurations such as implementing multiple layers of "base" configurations. Usually these configurations are harder for maintainers and other future readers to understand due to the multiple levels of indirection.</p>
<h5 id="base-test-configurations">Base Test Configurations<a class="headerlink" href="#base-test-configurations" title="Permanent link">#</a></h5>
<p>If a resource requires the same Terraform configuration as a prerequisite for all test configurations, then a common pattern is implementing a "base" test configuration that is combined with each test configuration.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfigBase</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="s">`</span>
<span class="s">resource &quot;aws_iam_role&quot; &quot;test&quot; {</span>
<span class="s">  # ... omitted for brevity ...</span>
<span class="s">}</span>

<span class="s">resource &quot;aws_iam_role_policy&quot; &quot;test&quot; {</span>
<span class="s">  # ... omitted for brevity ...</span>
<span class="s">}</span>
<span class="s">`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfig</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigCompose</span><span class="p">(</span>
<span class="w">    </span><span class="nx">testAccExampleThingConfigBase</span><span class="p">(),</span>
<span class="w">    </span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  # ... omitted for brevity ...</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="available-common-test-configurations">Available Common Test Configurations<a class="headerlink" href="#available-common-test-configurations" title="Permanent link">#</a></h5>
<p>These test configurations are typical implementations we have found or allow testing to implement best practices easier, since the Terraform AWS Provider testing is expected to run against various AWS Regions and Partitions.</p>
<ul>
<li><code>acctest.AvailableEC2InstanceTypeForRegion("type1", "type2", ...)</code>: Typically used to replace hardcoded EC2 Instance Types. Uses <code>aws_ec2_instance_type_offering</code> data source to return an available EC2 Instance Type in preferred ordering. Reference the instance type via: <code>data.aws_ec2_instance_type_offering.available.instance_type</code>. Use <code>acctest.AvailableEC2InstanceTypeForRegionNamed("name", "type1", "type2", ...)</code> to specify a name for the data source</li>
<li><code>acctest.ConfigLatestAmazonLinuxHVMEBSAMI()</code>: Typically used to replace hardcoded EC2 Image IDs (<code>ami-12345678</code>). Uses <code>aws_ami</code> data source to find the latest Amazon Linux image. Reference the AMI ID via: <code>data.aws_ami.amzn-ami-minimal-hvm-ebs.id</code></li>
</ul>
<h4 id="randomized-naming">Randomized Naming<a class="headerlink" href="#randomized-naming" title="Permanent link">#</a></h4>
<p>For AWS resources that require unique naming, the tests should implement a randomized name, typically coded as a <code>rName</code> variable in the test and passed as a parameter to create the test configuration.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// ... omitted for brevity ...</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="p">),</span>
<span class="w">        </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  name = %[1]q</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Typically the <code>rName</code> is always the first argument to the test configuration function, if used, for consistency.</p>
<p>Note that if <code>rName</code> (or any other variable) is used multiple times in the <code>fmt.Sprintf()</code> statement, <em>do not</em> repeat <code>rName</code> in the <code>fmt.Sprintf()</code> arguments. Using <code>fmt.Sprintf(..., rName, rName)</code>, for example, would not be correct. Instead, use the indexed <code>%[1]q</code> (or <code>%[x]q</code>, <code>%[x]s</code>, <code>%[x]t</code>, or <code>%[x]d</code>, where <code>x</code> represents the index number) verb multiple times. For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  name = %[1]q</span>

<span class="s">  tags = {</span>
<span class="s">    Name = %[1]q</span>
<span class="s">  }</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="other-recommended-variables">Other Recommended Variables<a class="headerlink" href="#other-recommended-variables" title="Permanent link">#</a></h4>
<p>We also typically recommend saving a <code>resourceName</code> variable in the test that contains the resource reference, e.g., <code>aws_example_thing.test</code>, which is repeatedly used in the checks.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleThingExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">CheckResourceAttrRegionalARN</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;arn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;thing/%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">)),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ResourceName</span><span class="p">:</span><span class="w">      </span><span class="nx">resourceName</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportState</span><span class="p">:</span><span class="w">       </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportStateVerify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// below all TestAcc functions</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  name = %[1]q</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="basic-acceptance-tests">Basic Acceptance Tests<a class="headerlink" href="#basic-acceptance-tests" title="Permanent link">#</a></h4>
<p>Usually this test is implemented first. The test configuration should contain only required arguments (<code>Required: true</code> attributes) and it should check the values of all read-only attributes (<code>Computed: true</code> without <code>Optional: true</code>). If the resource supports it, it verifies import. It should <em>NOT</em> perform other <code>TestStep</code> such as updates or verify recreation.</p>
<p>These are typically named <code>TestAcc{SERVICE}{THING}_basic</code>, e.g., <code>TestAccCloudWatchDashboard_basic</code></p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">                 </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">        </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5ProviderFactories</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckExampleThingDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleThingExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">CheckResourceAttrRegionalARN</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;arn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;thing/%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">)),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ResourceName</span><span class="p">:</span><span class="w">      </span><span class="nx">resourceName</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportState</span><span class="p">:</span><span class="w">       </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportStateVerify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// below all TestAcc functions</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  name = %[1]q</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="prechecks">PreChecks<a class="headerlink" href="#prechecks" title="Permanent link">#</a></h4>
<p>Acceptance test cases have a PreCheck. The PreCheck ensures that the testing environment meets certain preconditions. If the environment does not meet the preconditions, Go skips the test. Skipping a test avoids reporting a failure and wasting resources where the test cannot succeed.</p>
<p>Here is an example of the default PreCheck:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">     </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ... additional checks follow ...</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>Extend the default PreCheck by adding calls to functions in the anonymous PreCheck function. The functions can be existing functions in the provider or custom functions you add for new capabilities.</p>
<h5 id="standard-provider-prechecks">Standard Provider PreChecks<a class="headerlink" href="#standard-provider-prechecks" title="Permanent link">#</a></h5>
<p>If you add a new test that has preconditions which are checked by an existing provider function, use that standard PreCheck instead of creating a new one. Some existing tests are missing standard PreChecks and you can help by adding them where appropriate.</p>
<p>These are some of the standard provider PreChecks:</p>
<ul>
<li><code>acctest.PreCheckRegion(t *testing.T, regions ...string)</code> checks that the test region is one of the specified AWS Regions.</li>
<li><code>acctest.PreCheckRegionNot(t *testing.T, regions ...string)</code> checks that the test region is not one of the specified AWS Regions.</li>
<li><code>acctest.PreCheckAlternateRegionIs(t *testing.T, region string)</code> checks that the alternate test region is the specified AWS Region.</li>
<li><code>acctest.PreCheckPartition(t *testing.T, partition string)</code> checks that the test partition is the specified partition.</li>
<li><code>acctest.PreCheckPartitionNot(t *testing.T, partitions ...string)</code> checks that the test partition is not one of the specified partitions.</li>
<li><code>acctest.PreCheckPartitionHasService(t *testing.T, serviceID string)</code> checks whether the current partition lists the service as part of its offerings. Note: AWS may not add new or public preview services to the service list immediately. This function will return a false positive in that case.</li>
<li><code>acctest.PreCheckOrganizationsAccount(ctx context.Context, t *testing.T)</code> checks whether the current account can perform AWS Organizations tests.</li>
<li><code>acctest.PreCheckAlternateAccount(t *testing.T)</code> checks whether the environment is set up for tests across accounts.</li>
<li><code>acctest.PreCheckMultipleRegion(t *testing.T, regions int)</code> checks whether the environment is set up for tests across regions.</li>
</ul>
<p>This is an example of using a standard PreCheck function. For an established service, such as WAF or FSx, use <code>acctest.PreCheckPartitionHasService()</code> and the service endpoint ID to check that a partition supports the service.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">     </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">);</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheckPartitionHasService</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">waf</span><span class="p">.</span><span class="nx">EndpointsID</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ... additional checks follow ...</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="custom-prechecks">Custom PreChecks<a class="headerlink" href="#custom-prechecks" title="Permanent link">#</a></h5>
<p>In situations where standard PreChecks do not test for the required preconditions, create a custom PreCheck.</p>
<p>Below is an example of adding a custom PreCheck function. For a new or preview service that AWS does not include in the partition service list yet, you can verify the existence of the service with a simple read-only request (e.g., list all X service things). (For acceptance tests of established services, use <code>acctest.PreCheckPartitionHasService()</code> instead.)</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">     </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">),</span><span class="w"> </span><span class="nx">testAccPreCheckExample</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ... additional checks follow ...</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccPreCheckExample</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Provider</span><span class="p">.</span><span class="nx">Meta</span><span class="p">().(</span><span class="o">*</span><span class="nx">conns</span><span class="p">.</span><span class="nx">AWSClient</span><span class="p">).</span><span class="nx">ExampleConn</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">example</span><span class="p">.</span><span class="nx">ListThingsInput</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">ListThingsWithContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">input</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">testAccPreCheckSkipError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Skipf</span><span class="p">(</span><span class="s">&quot;skipping acceptance testing: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;unexpected PreCheck error: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="errorchecks">ErrorChecks<a class="headerlink" href="#errorchecks" title="Permanent link">#</a></h4>
<p>Acceptance test cases have an ErrorCheck. The ErrorCheck provides a chance to take a look at errors before the test fails. While most errors should result in test failure, some should not. For example, an error that indicates an API operation is not supported in a particular region should cause the test to skip instead of fail. Since errors should flow through the ErrorCheck, do not handle the vast majority of failing conditions. Instead, in ErrorCheck, focus on the rare errors that should cause a test to skip, or in other words, be ignored.</p>
<h5 id="common-errorcheck">Common ErrorCheck<a class="headerlink" href="#common-errorcheck" title="Permanent link">#</a></h5>
<p>In many situations, the common ErrorCheck is sufficient. It will skip tests for several normal occurrences such as when AWS reports a feature is not supported in the current region.</p>
<p>Here is an example of the common ErrorCheck:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// PreCheck</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">   </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">    </span><span class="c1">// ... additional checks follow ...</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="service-specific-errorchecks">Service-Specific ErrorChecks<a class="headerlink" href="#service-specific-errorchecks" title="Permanent link">#</a></h5>
<p>However, some services have special conditions that aren't caught by the common ErrorCheck. In these cases, you can create a service-specific ErrorCheck.</p>
<p>To add a service-specific ErrorCheck, follow these steps:</p>
<ol>
<li>Make sure there is not already an ErrorCheck for the service you have in mind. For example, search the codebase for <code>acctest.RegisterServiceErrorCheckFunc(names.ExampleServiceID</code> replacing "service" with the package name of the service you're working on (e.g., <code>ec2</code>). If there is already an ErrorCheck for the service, add it to the existing service-specific ErrorCheck.</li>
<li>Create the service-specific ErrorCheck in an <code>_test.go</code> file for the service. See the example below.</li>
<li>Register the new service-specific ErrorCheck in the <code>init()</code> at the top of the <code>_test.go</code> file. See the example below.</li>
</ol>
<p>An example of adding a service-specific ErrorCheck:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// just after the imports, create or add to the init() function</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">RegisterServiceErrorCheck</span><span class="p">(</span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">,</span><span class="w"> </span><span class="nx">testAccErrorCheckSkipService</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// ... additional code and tests ...</span>

<span class="c1">// this is the service-specific ErrorCheck</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">testAccErrorCheckSkipService</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ErrorCheckFunc</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheckSkipMessagesContaining</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;Error message specific to the service that indicates unsupported features&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;You can include from one to many portions of error messages&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;Be careful to not inadvertently capture errors that should not be skipped&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="long-running-test-guards">Long-Running Test Guards<a class="headerlink" href="#long-running-test-guards" title="Permanent link">#</a></h4>
<p>For any acceptance tests that typically run longer than 300 seconds (5 minutes), add a <code>-short</code> test guard at the top of the test function.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_longRunningTest</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">testing</span><span class="p">.</span><span class="nx">Short</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Skip</span><span class="p">(</span><span class="s">&quot;skipping long-running test in short mode&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ... omitted for brevity ...</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ... omitted for brevity ...</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>When running acceptance tests, tests with these guards can be skipped using the Go <code>-short</code> flag. See <a href="#running-only-short-tests">Running Only Short Tests</a> for examples.</p>
<h4 id="disappears-acceptance-tests">Disappears Acceptance Tests<a class="headerlink" href="#disappears-acceptance-tests" title="Permanent link">#</a></h4>
<p>This test is generally implemented second. It is straightforward to set up once the basic test is passing since it can reuse that test configuration. It prevents a common bug report with Terraform resources that error when they can not be found (e.g., deleted outside Terraform).</p>
<p>These are typically named <code>TestAcc{SERVICE}{THING}_disappears</code>, e.g., <code>TestAccCloudWatchDashboard_disappears</code></p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_disappears</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">                 </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">        </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5ProviderFactories</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckExampleThingDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleThingExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">job</span><span class="p">),</span>
<span class="w">          </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">CheckResourceDisappears</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Provider</span><span class="p">,</span><span class="w"> </span><span class="nx">ResourceExampleThing</span><span class="p">(),</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nx">ExpectNonEmptyPlan</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ConfigPlanChecks</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ConfigPlanChecks</span><span class="p">{</span>
<span class="w">          </span><span class="nx">PostApplyPostRefresh</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">PlanCheck</span><span class="p">{</span>
<span class="w">            </span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">ExpectResourceAction</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">ResourceActionCreate</span><span class="p">),</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>If this test does fail, the fix for this is generally adding error handling immediately after the <code>Read</code> API call that catches the error and tells Terraform to remove the resource before returning the error:</p>
<div class="highlight"><pre><span></span><code><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">GetThing</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">IsNewResource</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">tfresource</span><span class="p">.</span><span class="nx">NotFound</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[WARN] Example Thing (%s) not found, removing from state&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Id</span><span class="p">())</span>
<span class="w">  </span><span class="nx">d</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;reading Example Thing (%s): %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Id</span><span class="p">(),</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>For children resources that are encapsulated by a parent resource, it is also preferable to verify that removing the parent resource will not generate an error either. These are typically named <code>TestAcc{SERVICE}{THING}_disappears_{PARENT}</code>, e.g., <code>TestAccRoute53ZoneAssociation_disappears_Vpc</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleChildThing_disappears_ParentThing</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">parentResourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_parent_thing.test&quot;</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_child_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">                 </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">        </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5ProviderFactories</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckExampleChildThingDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleThingExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">CheckResourceDisappears</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Provider</span><span class="p">,</span><span class="w"> </span><span class="nx">ResourceExampleParentThing</span><span class="p">(),</span><span class="w"> </span><span class="nx">parentResourceName</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nx">ExpectNonEmptyPlan</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ConfigPlanChecks</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ConfigPlanChecks</span><span class="p">{</span>
<span class="w">          </span><span class="nx">PostApplyPostRefresh</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">PlanCheck</span><span class="p">{</span>
<span class="w">            </span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">ExpectResourceAction</span><span class="p">(</span><span class="nx">parentResourceName</span><span class="p">,</span><span class="w"> </span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">ResourceActionCreate</span><span class="p">),</span>
<span class="w">            </span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">ExpectResourceAction</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="nx">plancheck</span><span class="p">.</span><span class="nx">ResourceActionCreate</span><span class="p">),</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="per-attribute-acceptance-tests">Per Attribute Acceptance Tests<a class="headerlink" href="#per-attribute-acceptance-tests" title="Permanent link">#</a></h4>
<p>These are typically named <code>TestAcc{SERVICE}{THING}_{ATTRIBUTE}</code>, e.g., <code>TestAccCloudWatchDashboard_Name</code></p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_Description</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">                 </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">        </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5ProviderFactories</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckExampleThingDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingConfigDescription</span><span class="p">(</span><span class="nx">rName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description1&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleThingExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description1&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ResourceName</span><span class="p">:</span><span class="w">      </span><span class="nx">resourceName</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportState</span><span class="p">:</span><span class="w">       </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportStateVerify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingConfigDescription</span><span class="p">(</span><span class="nx">rName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description2&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleThingExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description2&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// below all TestAcc functions</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingConfigDescription</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  description = %[2]q</span>
<span class="s">  name        = %[1]q</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="cross-account-acceptance-tests">Cross-Account Acceptance Tests<a class="headerlink" href="#cross-account-acceptance-tests" title="Permanent link">#</a></h4>
<p>When testing requires AWS infrastructure in a second AWS account, the below changes to the normal setup will allow the management or reference of resources and data sources across accounts:</p>
<ul>
<li>In the <code>PreCheck</code> function, include <code>acctest.PreCheckAlternateAccount(ctx, t)</code> to ensure a standardized set of information is required for cross-account testing credentials</li>
<li>Switch usage of <code>ProtoV5ProviderFactories: acctest.ProtoV5ProviderFactories</code> to <code>ProtoV5ProviderFactories: acctest.ProtoV5FactoriesAlternate(ctx, t)</code></li>
<li>Add <code>acctest.ConfigAlternateAccountProvider()</code> to the test configuration and use <code>provider = awsalternate</code> for cross-account resources. The resource that is the focus of the acceptance test should <em>not</em> use the alternate provider identification to simplify the testing setup</li>
<li>For any <code>TestStep</code> that includes <code>ImportState: true</code>, add the <code>Config</code> that matches the previous <code>TestStep</code> <code>Config</code></li>
</ul>
<p>An example acceptance test implementation can be seen below:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExample_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<span class="w">      </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheckAlternateAccount</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">    </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5FactoriesAlternate</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">),</span>
<span class="w">    </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckExampleDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleConfig</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="c1">// ... additional checks ...</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w">            </span><span class="nx">testAccExampleConfig</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">ResourceName</span><span class="p">:</span><span class="w">      </span><span class="nx">resourceName</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportState</span><span class="p">:</span><span class="w">       </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportStateVerify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleConfig</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigCompose</span><span class="p">(</span>
<span class="w">    </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigAlternateAccountProvider</span><span class="p">(),</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s"># Cross account resources should be handled by the cross account provider.</span>
<span class="s"># The standardized provider block to use is awsalternate as seen below.</span>
<span class="s">resource &quot;aws_cross_account_example&quot; &quot;test&quot; {</span>
<span class="s">  provider = awsalternate</span>

<span class="s">  # ... configuration ...</span>
<span class="s">}</span>

<span class="s"># The resource that is the focus of the testing should be handled by the default provider,</span>
<span class="s"># which is automatically done by not specifying the provider configuration in the resource.</span>
<span class="s">resource &quot;aws_example&quot; &quot;test&quot; {</span>
<span class="s">  # ... configuration ...</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<p>Searching for the usage of <code>acctest.PreCheckAlternateAccount</code> in the codebase will yield real-world examples of this setup in action.</p>
<h4 id="cross-region-acceptance-tests">Cross-Region Acceptance Tests<a class="headerlink" href="#cross-region-acceptance-tests" title="Permanent link">#</a></h4>
<p>When testing requires AWS infrastructure in a second or third AWS region, the below changes to the normal setup will allow the management or reference of resources and data sources across regions:</p>
<ul>
<li>In the <code>PreCheck</code> function, include <code>acctest.PreCheckMultipleRegion(t, ###)</code> to ensure a standardized set of information is required for cross-region testing configuration. If the infrastructure in the second AWS region is also in a second AWS account also include <code>acctest.PreCheckAlternateAccount(ctx, t)</code></li>
<li>Switch usage of <code>ProtoV5ProviderFactories: acctest.ProtoV5ProviderFactories</code> to <code>ProtoV5ProviderFactories: acctest.ProtoV5FactoriesMultipleRegions(ctx, t, 2)</code> (where the last parameter is number of regions, 2 or 3)</li>
<li>Add <code>acctest.ConfigMultipleRegionProvider(###)</code> to the test configuration and use <code>provider = awsalternate</code> (and potentially <code>provider = awsthird</code>) for cross-region resources. The resource that is the focus of the acceptance test should <em>not</em> use the alternative providers to simplify the testing setup. If the infrastructure in the second AWS region is also in a second AWS account use <code>testAccAlternateAccountAlternateRegionProviderConfig()</code> (EC2) instead</li>
<li>For any <code>TestStep</code> that includes <code>ImportState: true</code>, add the <code>Config</code> that matches the previous <code>TestStep</code> <code>Config</code></li>
</ul>
<p>An example acceptance test implementation can be seen below:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExample_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">providers</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">schema</span><span class="p">.</span><span class="nx">Provider</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<span class="w">      </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheckMultipleRegion</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">    </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5FactoriesMultipleRegions</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
<span class="w">    </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckExampleDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleConfig</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="c1">// ... additional checks ...</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w">            </span><span class="nx">testAccExampleConfig</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">ResourceName</span><span class="p">:</span><span class="w">      </span><span class="nx">resourceName</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportState</span><span class="p">:</span><span class="w">       </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ImportStateVerify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleConfig</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigCompose</span><span class="p">(</span>
<span class="w">    </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigMultipleRegionProvider</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s"># Cross region resources should be handled by the cross region provider.</span>
<span class="s"># The standardized provider is awsalternate as seen below.</span>
<span class="s">resource &quot;aws_cross_region_example&quot; &quot;test&quot; {</span>
<span class="s">  provider = awsalternate</span>

<span class="s">  # ... configuration ...</span>
<span class="s">}</span>

<span class="s"># The resource that is the focus of the testing should be handled by the default provider,</span>
<span class="s"># which is automatically done by not specifying the provider configuration in the resource.</span>
<span class="s">resource &quot;aws_example&quot; &quot;test&quot; {</span>
<span class="s">  # ... configuration ...</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<p>Searching for the usage of <code>acctest.PreCheckMultipleRegion</code> in the codebase will yield real-world examples of this setup in action.</p>
<h4 id="acceptance-test-concurrency">Acceptance Test Concurrency<a class="headerlink" href="#acceptance-test-concurrency" title="Permanent link">#</a></h4>
<p>Certain AWS service APIs allow a limited number of a certain component, while the acceptance testing runs at a default concurrency of twenty tests at a time. For example as of this writing, the SageMaker service only allows one SageMaker Domain per AWS Region. Running the tests with the default concurrency will fail with API errors relating to the component quota being exceeded.</p>
<p>When encountering these types of components, acceptance testing can be set up to limit the available concurrency of that particular component. When limited to one component at a time, this may also be referred to as serializing the acceptance tests.</p>
<p>To convert to serialized (one test at a time) acceptance testing:</p>
<ul>
<li>Convert all existing capital <code>T</code> test functions with the limited component to begin with a lowercase <code>t</code>, e.g., <code>TestAccSageMakerDomain_basic</code> becomes <code>testDomain_basic</code>. This will prevent the test framework from executing these tests directly as the prefix <code>Test</code> is required.<ul>
<li>In each of these test functions, convert <code>resource.ParallelTest</code> to <code>resource.Test</code></li>
</ul>
</li>
<li>Create a capital <code>T</code> <code>TestAcc{Service}{Thing}_serial</code> test function that then references all the lowercase <code>t</code> test functions. If multiple test files are referenced, this new test be created in a new shared file such as <code>internal/service/{SERVICE}/{SERVICE}_test.go</code>. The contents of this test can be set like the following:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThing_serial</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">t</span><span class="p">.</span><span class="nx">Parallel</span><span class="p">()</span>

<span class="w">    </span><span class="nx">testCases</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">){</span>
<span class="w">        </span><span class="s">&quot;Thing&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;basic&quot;</span><span class="p">:</span><span class="w">        </span><span class="nx">testAccThing_basic</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;disappears&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">testAccThing_disappears</span><span class="p">,</span>
<span class="w">            </span><span class="c1">// ... potentially other resource tests ...</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// ... potentially other top level resource test groups ...</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">RunSerialTests2Levels</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">testCases</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Future iterations of these acceptance testing concurrency instructions will include the ability to handle more than one component at a time including service quota lookup, if supported by the service API.</p>
</div>
<h3 id="data-source-acceptance-testing">Data Source Acceptance Testing<a class="headerlink" href="#data-source-acceptance-testing" title="Permanent link">#</a></h3>
<p>Writing acceptance testing for data sources is similar to resources, with the biggest changes being:</p>
<ul>
<li>Adding <code>DataSource</code> to the test and configuration naming, such as <code>TestAccExampleThingDataSource_Filter</code></li>
<li>The basic test <em>may</em> be named after the easiest lookup attribute instead, e.g., <code>TestAccExampleThingDataSource_Name</code></li>
<li>No disappears testing</li>
<li>Almost all checks should be done with <a href="https://pkg.go.dev/github.com/hashicorp/terraform-plugin-testing/helper/resource?tab=doc#TestCheckResourceAttrPair"><code>resource.TestCheckResourceAttrPair()</code></a> to compare the data source attributes to the resource attributes</li>
<li>The usage of an additional <code>dataSourceName</code> variable to store a data source reference, e.g., <code>data.aws_example_thing.test</code></li>
</ul>
<p>Data sources testing should still use the <code>CheckDestroy</code> function of the resource, just to continue verifying that there are no dangling AWS resources after a test is run.</p>
<p>Please note that we do not recommend re-using test configurations between resources and their associated data source as it is harder to discover testing regressions. Authors are encouraged to potentially implement similar "base" configurations though.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccExampleThingDataSource_Name</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<span class="w">  </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">  </span><span class="nx">dataSourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;data.aws_example_thing.test&quot;</span>
<span class="w">  </span><span class="nx">resourceName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;aws_example_thing.test&quot;</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PreCheck</span><span class="p">:</span><span class="w">                 </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">PreCheck</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">ErrorCheck</span><span class="p">:</span><span class="w">               </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ErrorCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">ExampleServiceID</span><span class="p">),</span>
<span class="w">    </span><span class="nx">ProtoV5ProviderFactories</span><span class="p">:</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ProtoV5ProviderFactories</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CheckDestroy</span><span class="p">:</span><span class="w">             </span><span class="nx">testAccCheckExampleThingDestroy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">),</span>
<span class="w">    </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccExampleThingDataSourceConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">          </span><span class="nx">testAccCheckExampleThingExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">resourceName</span><span class="p">),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttrPair</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;arn&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dataSourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;arn&quot;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttrPair</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dataSourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">),</span>
<span class="w">          </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttrPair</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dataSourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// below all TestAcc functions</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccExampleThingDataSourceConfigName</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  name = %[1]q</span>
<span class="s">}</span>

<span class="s">data &quot;aws_example_thing&quot; &quot;test&quot; {</span>
<span class="s">  name = aws_example_thing.test.name</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="acceptance-test-sweepers">Acceptance Test Sweepers<a class="headerlink" href="#acceptance-test-sweepers" title="Permanent link">#</a></h2>
<p>When running the acceptance tests, especially when developing or troubleshooting Terraform resources, it's possible for code bugs or other issues to prevent the proper destruction of AWS infrastructure. To prevent lingering resources from consuming quota or causing unexpected billing, the Terraform Plugin SDK supports the test sweeper framework to clear out an AWS region of all resources. This section is meant to augment the <a href="https://www.terraform.io/plugin/sdkv2/testing/acceptance-tests/sweepers">SDKv2 documentation on test sweepers</a> with Terraform AWS Provider specific details.</p>
<h3 id="running-test-sweepers">Running Test Sweepers<a class="headerlink" href="#running-test-sweepers" title="Permanent link">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Test Sweepers will destroy AWS infrastructure and backups in the target AWS account and region! These are designed to override any API deletion protection. Never run these outside a development AWS account that should be completely empty of resources. <!-- markdownlint-disable-line code-block-style --></p>
</div>
<p>To run the sweepers for all resources in <code>us-west-2</code> and <code>us-east-1</code> (default testing regions):</p>
<div class="highlight"><pre><span></span><code><span class="go">make sweep</span>
</code></pre></div>
<p>To run a specific resource sweeper:</p>
<div class="highlight"><pre><span></span><code><span class="go">SWEEPARGS=-sweep-run=aws_example_thing make sweep</span>
</code></pre></div>
<p>To run sweepers with an assumed role, use the following additional environment variables:</p>
<ul>
<li><code>TF_AWS_ASSUME_ROLE_ARN</code> - Required.</li>
<li><code>TF_AWS_ASSUME_ROLE_DURATION</code> - Optional, defaults to 1 hour (3600).</li>
<li><code>TF_AWS_ASSUME_ROLE_EXTERNAL_ID</code> - Optional.</li>
<li><code>TF_AWS_ASSUME_ROLE_SESSION_NAME</code> - Optional.</li>
</ul>
<h3 id="sweeper-checklists">Sweeper Checklists<a class="headerlink" href="#sweeper-checklists" title="Permanent link">#</a></h3>
<ul>
<li><strong>Add Resource Sweeper Implementation</strong>: See <a href="#writing-test-sweepers">Writing Test Sweepers</a>.</li>
<li><strong>Add Service To Sweeper List</strong>: Once a <code>sweep.go</code> file is present in the service subdirectory, run <code>make gen</code> to regenerate the list of imports in <code>internal/sweep/sweep_test.go</code>.</li>
</ul>
<h3 id="writing-test-sweepers">Writing Test Sweepers<a class="headerlink" href="#writing-test-sweepers" title="Permanent link">#</a></h3>
<p>Sweeper logic should be written to a file called <code>sweep.go</code> in the appropriate service subdirectory (<code>internal/service/{serviceName}</code>).</p>
<p>First, implement the sweeper function.
If the AWS SDK provides a builtin list paginator for the resource, it should be used:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Terraform Plugin Framework (Preferred)</label><label for="__tabbed_1_2">Terraform Plugin SDK V2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">sweepThings</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">*</span><span class="nx">conns</span><span class="p">.</span><span class="nx">AWSClient</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">example</span><span class="p">.</span><span class="nx">ListThingsInput</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ExampleClient</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">        </span><span class="nx">paginator</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">example</span><span class="p">.</span><span class="nx">NewListThingsPaginator</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">paginator</span><span class="p">.</span><span class="nx">HasMorePages</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">page</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">paginator</span><span class="p">.</span><span class="nx">NextPage</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">Things</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="nx">framework</span><span class="p">.</span><span class="nx">NewSweepResource</span><span class="p">(</span><span class="nx">newResourceThing</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">framework</span><span class="p">.</span><span class="nx">NewAttribute</span><span class="p">(</span><span class="nx">names</span><span class="p">.</span><span class="nx">AttrID</span><span class="p">,</span><span class="w"> </span><span class="nx">aws</span><span class="p">.</span><span class="nx">ToString</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">ThingId</span><span class="p">))),</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">sweepThings</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">*</span><span class="nx">conns</span><span class="p">.</span><span class="nx">AWSClient</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">example</span><span class="p">.</span><span class="nx">ListThingsInput</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ExampleClient</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">        </span><span class="nx">paginator</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">example</span><span class="p">.</span><span class="nx">NewListThingsPaginator</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">paginator</span><span class="p">.</span><span class="nx">HasMorePages</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">page</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">paginator</span><span class="p">.</span><span class="nx">NextPage</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">page</span><span class="p">.</span><span class="nx">Things</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ResourceThing</span><span class="p">()</span>
<span class="w">                        </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
<span class="w">                        </span><span class="nx">d</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="nx">aws</span><span class="p">.</span><span class="nx">StringValue</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">Id</span><span class="p">))</span>

<span class="w">                        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="nx">sweep</span><span class="p">.</span><span class="nx">NewSweepResource</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>If no paginator is available, consider generating one using the <a href="https://github.com/hashicorp/terraform-provider-aws/blob/main/internal/generate/listpages/README.md"><code>listpages</code> generator</a>, or implement the sweeper as follows:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Terraform Plugin Framework (Preferred)</label><label for="__tabbed_2_2">Terraform Plugin SDK V2</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">sweepThings</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">*</span><span class="nx">conns</span><span class="p">.</span><span class="nx">AWSClient</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">example</span><span class="p">.</span><span class="nx">ListThingsInput</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ExampleClient</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">ListThings</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">input</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">Things</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="nx">framework</span><span class="p">.</span><span class="nx">NewSweepResource</span><span class="p">(</span><span class="nx">newResourceThing</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">framework</span><span class="p">.</span><span class="nx">NewAttribute</span><span class="p">(</span><span class="nx">names</span><span class="p">.</span><span class="nx">AttrID</span><span class="p">,</span><span class="w"> </span><span class="nx">aws</span><span class="p">.</span><span class="nx">ToString</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">ThingId</span><span class="p">))),</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">aws</span><span class="p">.</span><span class="nx">StringValue</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">NextToken</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">break</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="nx">input</span><span class="p">.</span><span class="nx">NextToken</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">NextToken</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">sweepThings</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">*</span><span class="nx">conns</span><span class="p">.</span><span class="nx">AWSClient</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">example</span><span class="p">.</span><span class="nx">ListThingsInput</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">conn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ExampleClient</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">sweep</span><span class="p">.</span><span class="nx">Sweepable</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">ListThings</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">input</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">Things</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ResourceThing</span><span class="p">()</span>
<span class="w">                        </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
<span class="w">                        </span><span class="nx">d</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="nx">aws</span><span class="p">.</span><span class="nx">StringValue</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">Id</span><span class="p">))</span>

<span class="w">                        </span><span class="nx">sweepResources</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="nx">sweep</span><span class="p">.</span><span class="nx">NewSweepResource</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">aws</span><span class="p">.</span><span class="nx">StringValue</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">NextToken</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">break</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="nx">input</span><span class="p">.</span><span class="nx">NextToken</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">NextToken</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">sweepResources</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Once the function is implemented, register it inside the exported <code>RegisterSweepers</code> function.
The final argument to the <code>awsv2.Register</code> function is a variadic string which can optionally list any dependencies which must be swept first.</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">RegisterSweepers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">awsv2</span><span class="p">.</span><span class="nx">Register</span><span class="p">(</span><span class="s">&quot;aws_example_thing&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sweepThings</span><span class="p">,</span>
<span class="w">                </span><span class="c1">// Optionally, add dependencies</span>
<span class="w">                </span><span class="s">&quot;aws_example_other_thing&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="acceptance-test-checklists">Acceptance Test Checklists<a class="headerlink" href="#acceptance-test-checklists" title="Permanent link">#</a></h2>
<p>There are several aspects to writing good acceptance tests. These checklists will help ensure effective testing from the design stage through to implementation details.</p>
<h3 id="basic-acceptance-test-design">Basic Acceptance Test Design<a class="headerlink" href="#basic-acceptance-test-design" title="Permanent link">#</a></h3>
<p>These are basic principles to help guide the creation of acceptance tests.</p>
<ul>
<li><strong>Covers Changes</strong>: Every line of resource or data source code added or changed should be covered by one or more tests. For example, if a resource has two ways of functioning, tests should cover both possible paths. Nearly every codebase change needs test coverage to ensure functionality and prevent future regressions. If a bug or other problem prompted a fix, a test should be added that previously would have failed, especially if the report included a configuration.</li>
<li><strong>Follows the Single Responsibility Principle</strong>: Every test should have a single responsibility and effectively test that responsibility. This may include individual tests for verifying basic functionality of the resource (Create, Read, Delete), separately verifying using and updating a single attribute in a resource, or separately changing between two attributes to verify two "modes"/"types" possible with a resource configuration. In following this principle, test configurations should be as simple as possible. For example, not including extra configuration unless it is necessary for the specific test.</li>
</ul>
<h3 id="test-implementation">Test Implementation<a class="headerlink" href="#test-implementation" title="Permanent link">#</a></h3>
<p>Below are the required items that will be noted during the submission review and prevent immediate merging:</p>
<ul>
<li><strong>Implements CheckDestroy</strong>: Resource testing should include a <code>CheckDestroy</code> function (typically named <code>testAccCheck{SERVICE}{RESOURCE}Destroy</code>) that calls the API to verify that the Terraform resource has been deleted or disassociated as appropriate. More information about <code>CheckDestroy</code> functions can be found in the <a href="https://www.terraform.io/plugin/sdkv2/testing/acceptance-tests/testcase#checkdestroy">SDKv2 TestCase documentation</a>.</li>
<li><strong>Implements Exists Check Function</strong>: Resource testing should include a <code>TestCheckFunc</code> function (typically named <code>testAccCheck{SERVICE}{RESOURCE}Exists</code>) that calls the API to verify that the Terraform resource has been created or associated as appropriate. Preferably, this function will also accept a pointer to an API object representing the Terraform resource from the API response that can be set for potential usage in later <code>TestCheckFunc</code>. More information about these functions can be found in the <a href="https://www.terraform.io/plugin/sdkv2/testing/acceptance-tests/teststep#custom-check-functions">SDKv2 Custom Check Functions documentation</a>.</li>
<li><strong>Excludes Provider Declarations</strong>: Test configurations should not include <code>provider "aws" {...}</code> declarations. If necessary, only the provider declarations in <code>acctest.go</code> should be used for multiple account/region or otherwise specialized testing.</li>
<li><strong>Passes in us-west-2 Region</strong>: Tests default to running in <code>us-west-2</code> and at a minimum should pass in that region or include necessary <code>PreCheck</code> functions to skip the test when run outside an expected environment.</li>
<li><strong>Includes ErrorCheck</strong>: All acceptance tests should include a call to the common ErrorCheck (<code>ErrorCheck:   acctest.ErrorCheck(t, names.ExampleServiceID),</code>).</li>
<li><strong>Uses resource.ParallelTest</strong>: Tests should use <a href="https://godoc.org/github.com/hashicorp/terraform/helper/resource#ParallelTest"><code>resource.ParallelTest()</code></a> instead of <a href="https://godoc.org/github.com/hashicorp/terraform/helper/resource#Test"><code>resource.Test()</code></a> except where serialized testing is absolutely required.</li>
<li>[ ] <strong>Uses fmt.Sprintf()</strong>: Test configurations preferably should be separated into their own functions (typically named <code>testAcc{SERVICE}{RESOURCE}Config{PURPOSE}</code>) that call <a href="https://golang.org/pkg/fmt/#Sprintf"><code>fmt.Sprintf()</code></a> for variable injection or a string <code>const</code> for completely static configurations. Test configurations should avoid <code>var</code> or other variable injection functionality such as <a href="https://golang.org/pkg/text/template/"><code>text/template</code></a>.</li>
<li><strong>Uses Randomized Infrastructure Naming</strong>: Test configurations that use resources where a unique name is required should generate a random name. Typically this is created via <code>rName := sdkacctest.RandomWithPrefix(acctest.ResourcePrefix)</code> in the acceptance test function before generating the configuration.</li>
<li><strong>Prevents S3 Bucket Deletion Errors</strong>: Test configurations that use <code>aws_s3_bucket</code> resources as a logging destination should include the <code>force_destroy = true</code> configuration. This is to prevent race conditions where logging objects may be written during the testing duration which will cause <code>BucketNotEmpty</code> errors during deletion.</li>
</ul>
<p>For resources that support import, the additional item below is required that will be noted during the submission review and prevent immediate merging:</p>
<ul>
<li><strong>Implements ImportState Testing</strong>: Tests should include an additional <code>TestStep</code> configuration that verifies resource import via <code>ImportState: true</code> and <code>ImportStateVerify: true</code>. This <code>TestStep</code> should be added to all possible tests for the resource to ensure that all infrastructure configurations are properly imported into Terraform.</li>
</ul>
<p>The below are style-based items that <em>may</em> be noted during review and are recommended for simplicity, consistency, and quality assurance:</p>
<ul>
<li><strong>Uses Builtin Check Functions</strong>: Tests should use already available check functions, e.g. <code>resource.TestCheckResourceAttr()</code>, to verify values in the Terraform state over creating custom <code>TestCheckFunc</code>. More information about these functions can be found in the <a href="https://www.terraform.io/plugin/sdkv2/testing/acceptance-tests/teststep#builtin-check-functions">SDKv2 Builtin Check Functions documentation</a>.</li>
<li><strong>Uses TestCheckResourceAttrPair() for Data Sources</strong>: Tests should use <a href="https://godoc.org/github.com/hashicorp/terraform/helper/resource#TestCheckResourceAttrPair"><code>resource.TestCheckResourceAttrPair()</code></a> to verify values in the Terraform state for data sources attributes to compare them with their expected resource attributes.</li>
<li><strong>Excludes Timeouts Configurations</strong>: Test configurations should not include <code>timeouts {...}</code> configuration blocks except for explicit testing of customizable timeouts (typically very short timeouts with <code>ExpectError</code>).</li>
<li><strong>Implements Default and Zero Value Validation</strong>: The basic test for a resource (typically named <code>TestAcc{SERVICE}{RESOURCE}_basic</code>) should use available check functions, e.g. <code>resource.TestCheckResourceAttr()</code>, to verify default and zero values in the Terraform state for all attributes. Empty/missing configuration blocks can be verified with <code>resource.TestCheckResourceAttr(resourceName, "{ATTRIBUTE}.#", "0")</code> and empty maps with <code>resource.TestCheckResourceAttr(resourceName, "{ATTRIBUTE}.%", "0")</code></li>
</ul>
<h3 id="avoid-hard-coding">Avoid Hard Coding<a class="headerlink" href="#avoid-hard-coding" title="Permanent link">#</a></h3>
<p>Avoid hard coding values in acceptance test checks and configurations for consistency and testing flexibility. Resource testing is expected to pass across multiple AWS environments supported by the Terraform AWS Provider (e.g., AWS Standard and AWS GovCloud (US)). Contributors are not expected or required to perform testing outside of AWS Standard, e.g., running only in the <code>us-west-2</code> region is perfectly acceptable. However, contributors are expected to avoid hard coding with these guidelines.</p>
<h4 id="hardcoded-account-ids">Hardcoded Account IDs<a class="headerlink" href="#hardcoded-account-ids" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses Account Data Sources</strong>: Any hardcoded account numbers in configuration, e.g., <code>137112412989</code>, should be replaced with a data source. Depending on the situation, there are several data sources for account IDs including:<ul>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity"><code>aws_caller_identity</code> data source</a>,</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/canonical_user_id"><code>aws_canonical_user_id</code> data source</a>,</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/billing_service_account"><code>aws_billing_service_account</code> data source</a>, and</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/sagemaker_prebuilt_ecr_image"><code>aws_sagemaker_prebuilt_ecr_image</code> data source</a>.</li>
</ul>
</li>
<li><strong>Uses Account Test Checks</strong>: Any check required to verify an AWS Account ID of the current testing account or another account should use one of the following available helper functions over the usage of <code>resource.TestCheckResourceAttrSet()</code> and <code>resource.TestMatchResourceAttr()</code>:<ul>
<li><code>acctest.CheckResourceAttrAccountID()</code>: Validates the state value equals the AWS Account ID of the current account running the test. This is the most common implementation.</li>
<li><code>acctest.MatchResourceAttrAccountID()</code>: Validates the state value matches any AWS Account ID (e.g. a 12 digit number). This is typically only used in data source testing of AWS managed components.</li>
</ul>
</li>
</ul>
<p>Here's an example of using <code>aws_caller_identity</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_caller_identity&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_backup_selection&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">plan_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_backup_plan.test.id</span>
<span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tf_acc_test_backup_selection_%[1]d&quot;</span>
<span class="w">  </span><span class="na">iam_role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:${data.aws_partition.current.partition}:iam::${data.aws_caller_identity.current.account_id}:role/service-role/AWSBackupDefaultServiceRole&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-ami-ids">Hardcoded AMI IDs<a class="headerlink" href="#hardcoded-ami-ids" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses aws_ami Data Source</strong>: Any hardcoded AMI ID configuration, e.g. <code>ami-12345678</code>, should be replaced with the <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami"><code>aws_ami</code> data source</a> pointing to an Amazon Linux image. The package <code>internal/acctest</code> includes test configuration helper functions to simplify these lookups:<ul>
<li><code>acctest.ConfigLatestAmazonLinuxHVMEBSAMI()</code>: The recommended AMI for most situations, using Amazon Linux, HVM virtualization, and EBS storage. To reference the AMI ID in the test configuration: <code>data.aws_ami.amzn-ami-minimal-hvm-ebs.id</code>.</li>
<li><code>testAccLatestAmazonLinuxHVMInstanceStoreAMIConfig()</code> (EC2): AMI lookup using Amazon Linux, HVM virtualization, and Instance Store storage. Should only be used in testing that requires Instance Store storage rather than EBS. To reference the AMI ID in the test configuration: <code>data.aws_ami.amzn-ami-minimal-hvm-instance-store.id</code>.</li>
<li><code>testAccLatestAmazonLinuxPVEBSAMIConfig()</code> (EC2): AMI lookup using Amazon Linux, Paravirtual virtualization, and EBS storage. Should only be used in testing that requires Paravirtual over Hardware Virtual Machine (HVM) virtualization. To reference the AMI ID in the test configuration: <code>data.aws_ami.amzn-ami-minimal-pv-ebs.id</code>.</li>
<li><code>configLatestAmazonLinuxPvInstanceStoreAmi</code> (EC2): AMI lookup using Amazon Linux, Paravirtual virtualization, and Instance Store storage. Should only be used in testing that requires Paravirtual virtualization over HVM and Instance Store storage over EBS. To reference the AMI ID in the test configuration: <code>data.aws_ami.amzn-ami-minimal-pv-instance-store.id</code>.</li>
<li><code>testAccLatestWindowsServer2016CoreAMIConfig()</code> (EC2): AMI lookup using Windows Server 2016 Core, HVM virtualization, and EBS storage. Should only be used in testing that requires Windows. To reference the AMI ID in the test configuration: <code>data.aws_ami.win2016core-ami.id</code>.</li>
</ul>
</li>
</ul>
<p>Here's an example of using <code>acctest.ConfigLatestAmazonLinuxHVMEBSAMI()</code> and <code>data.aws_ami.amzn-ami-minimal-hvm-ebs.id</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">testAccLaunchConfigurationDataSourceConfig_basic</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigCompose</span><span class="p">(</span>
<span class="w">        </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigLatestAmazonLinuxHVMEBSAMI</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_launch_configuration&quot; &quot;test&quot; {</span>
<span class="s">  name          = %[1]q</span>
<span class="s">  image_id      = data.aws_ami.amzn-ami-minimal-hvm-ebs.id</span>
<span class="s">  instance_type = &quot;m1.small&quot;</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-availability-zones">Hardcoded Availability Zones<a class="headerlink" href="#hardcoded-availability-zones" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses aws_availability_zones Data Source</strong>: Any hardcoded AWS Availability Zone configuration, e.g. <code>us-west-2a</code>, should be replaced with the <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/availability_zones"><code>aws_availability_zones</code> data source</a>. Use the convenience function called <code>acctest.ConfigAvailableAZsNoOptIn()</code> (defined in <code>internal/acctest/acctest.go</code>) to declare <code>data "aws_availability_zones" "available" {...}</code>. You can then reference the data source via <code>data.aws_availability_zones.available.names[0]</code> or <code>data.aws_availability_zones.available.names[count.index]</code> in resources using <code>count</code>.</li>
</ul>
<p>Here's an example of using <code>acctest.ConfigAvailableAZsNoOptIn()</code> and <code>data.aws_availability_zones.available.names[0]</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">testAccInstanceVpcConfigBasic</span><span class="p">(</span><span class="nx">rName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigCompose</span><span class="p">(</span>
<span class="w">        </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigAvailableAZsNoOptIn</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_subnet&quot; &quot;test&quot; {</span>
<span class="s">  availability_zone = data.aws_availability_zones.available.names[0]</span>
<span class="s">  cidr_block        = &quot;10.0.0.0/24&quot;</span>
<span class="s">  vpc_id            = aws_vpc.test.id</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-database-versions">Hardcoded Database Versions<a class="headerlink" href="#hardcoded-database-versions" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses Database Version Data Sources</strong>: Hardcoded database versions, e.g., RDS MySQL Engine Version <code>5.7.42</code>, should be removed (which means the AWS-defined default version will be used) or replaced with a list of preferred versions using a data source. Because versions change over time and version offerings vary from region to region and partition to partition, using the default version or providing a list of preferences ensures a version will be available. Depending on the situation, there are several data sources for versions, including:<ul>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/rds_engine_version"><code>aws_rds_engine_version</code> data source</a>,</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/docdb_engine_version"><code>aws_docdb_engine_version</code> data source</a>, and</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/neptune_engine_version"><code>aws_neptune_engine_version</code> data source</a>.</li>
</ul>
</li>
</ul>
<p>Here's an example of using <code>aws_rds_engine_version</code> and <code>data.aws_rds_engine_version.default.version</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_rds_engine_version&quot;</span><span class="w"> </span><span class="nv">&quot;default&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mysql&quot;</span>
<span class="p">}</span>

<span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_rds_orderable_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">engine</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_engine_version.default.engine</span>
<span class="w">  </span><span class="na">engine_version</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_engine_version.default.version</span>
<span class="w">  </span><span class="na">preferred_instance_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;db.t3.small&quot;, &quot;db.t2.small&quot;, &quot;db.t2.medium&quot;</span><span class="p">]</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;bar&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">engine</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_engine_version.default.engine</span>
<span class="w">  </span><span class="na">engine_version</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_engine_version.default.version</span>
<span class="w">  </span><span class="na">instance_class</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_orderable_db_instance.test.instance_class</span>
<span class="w">  </span><span class="na">skip_final_snapshot</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">parameter_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;default.${data.aws_rds_engine_version.default.parameter_group_family}&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-direct-connect-locations">Hardcoded Direct Connect Locations<a class="headerlink" href="#hardcoded-direct-connect-locations" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses aws_dx_locations Data Source</strong>: Hardcoded AWS Direct Connect locations, e.g., <code>EqSe2</code>, should be replaced with the <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/dx_locations"><code>aws_dx_locations</code> data source</a>.</li>
</ul>
<p>Here's an example using <code>data.aws_dx_locations.test.location_codes</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_dx_locations&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_dx_lag&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">name</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Test LAG&quot;</span>
<span class="w">  </span><span class="na">connections_bandwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1Gbps&quot;</span>
<span class="w">  </span><span class="na">location</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nf">tolist</span><span class="p">(</span><span class="nv">data.aws_dx_locations.test.location_codes</span><span class="p">)[</span><span class="m">0</span><span class="p">]</span>
<span class="w">  </span><span class="na">force_destroy</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-instance-types">Hardcoded Instance Types<a class="headerlink" href="#hardcoded-instance-types" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses Instance Type Data Source</strong>: Singular hardcoded instance types and classes, e.g., <code>t2.micro</code> and <code>db.t2.micro</code>, should be replaced with a list of preferences using a data source. Because offerings vary from region to region and partition to partition, providing a list of preferences dramatically improves the likelihood that one of the options will be available. Depending on the situation, there are several data sources for instance types and classes, including:<ul>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ec2_instance_type_offering"><code>aws_ec2_instance_type_offering</code> data source</a> - Convenience functions declare configurations that are referenced with <code>data.aws_ec2_instance_type_offering.available</code> including:<ul>
<li>The <code>acctest.AvailableEC2InstanceTypeForAvailabilityZone()</code> function for test configurations using an EC2 Subnet which is inherently within a single Availability Zone</li>
<li>The <code>acctest.AvailableEC2InstanceTypeForRegion()</code> function for test configurations that do not include specific Availability Zones</li>
</ul>
</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/rds_orderable_db_instance"><code>aws_rds_orderable_db_instance</code> data source</a>,</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/neptune_orderable_db_instance"><code>aws_neptune_orderable_db_instance</code> data source</a>, and</li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/docdb_orderable_db_instance"><code>aws_docdb_orderable_db_instance</code> data source</a>.</li>
</ul>
</li>
</ul>
<p>Here's an example of using <code>acctest.AvailableEC2InstanceTypeForRegion()</code> and <code>data.aws_ec2_instance_type_offering.available.instance_type</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">testAccSpotInstanceRequestConfig</span><span class="p">(</span><span class="nx">rInt</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ConfigCompose</span><span class="p">(</span>
<span class="w">        </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">AvailableEC2InstanceTypeForRegion</span><span class="p">(</span><span class="s">&quot;t3.micro&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;t2.micro&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_spot_instance_request&quot; &quot;test&quot; {</span>
<span class="s">  instance_type        = data.aws_ec2_instance_type_offering.available.instance_type</span>
<span class="s">  spot_price           = &quot;0.05&quot;</span>
<span class="s">  wait_for_fulfillment = true</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rInt</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>
<p>Here's an example of using <code>aws_rds_orderable_db_instance</code> and <code>data.aws_rds_orderable_db_instance.test.instance_class</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_rds_orderable_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">engine</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mysql&quot;</span>
<span class="w">  </span><span class="na">engine_version</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;5.7.31&quot;</span>
<span class="w">  </span><span class="na">preferred_instance_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;db.t3.micro&quot;, &quot;db.t2.micro&quot;, &quot;db.t3.small&quot;</span><span class="p">]</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">engine</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_orderable_db_instance.test.engine</span>
<span class="w">  </span><span class="na">engine_version</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_orderable_db_instance.test.engine_version</span>
<span class="w">  </span><span class="na">instance_class</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_rds_orderable_db_instance.test.instance_class</span>
<span class="w">  </span><span class="na">skip_final_snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">username</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-partition-dns-suffix">Hardcoded Partition DNS Suffix<a class="headerlink" href="#hardcoded-partition-dns-suffix" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses aws_partition Data Source</strong>: Any hardcoded DNS suffix configuration, e.g., the <code>amazonaws.com</code> in a <code>ec2.amazonaws.com</code> service principal, should be replaced with the <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/partition"><code>aws_partition</code> data source</a>. A common pattern is declaring <code>data "aws_partition" "current" {}</code> and referencing it via <code>data.aws_partition.current.dns_suffix</code>.</li>
</ul>
<p>Here's an example of using <code>aws_partition</code> and <code>data.aws_partition.current.dns_suffix</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_partition&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">POLICY</span>
<span class="sh">{</span>
<span class="sh">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span>
<span class="sh">  &quot;Statement&quot;: [</span>
<span class="sh">    {</span>
<span class="sh">      &quot;Sid&quot;: &quot;&quot;,</span>
<span class="sh">      &quot;Effect&quot;: &quot;Allow&quot;,</span>
<span class="sh">      &quot;Principal&quot;: {</span>
<span class="sh">        &quot;Service&quot;: &quot;cloudtrail.${data.aws_partition.current.dns_suffix}&quot;</span>
<span class="sh">      },</span>
<span class="sh">      &quot;Action&quot;: &quot;sts:AssumeRole&quot;</span>
<span class="sh">    }</span>
<span class="sh">  ]</span>
<span class="sh">}</span>
<span class="dl">POLICY</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-partition-in-arn">Hardcoded Partition in ARN<a class="headerlink" href="#hardcoded-partition-in-arn" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses aws_partition Data Source</strong>: Any hardcoded AWS Partition configuration, e.g. the <code>aws</code> in a <code>arn:aws:SERVICE:REGION:ACCOUNT:RESOURCE</code> ARN, should be replaced with the <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/partition"><code>aws_partition</code> data source</a>. A common pattern is declaring <code>data "aws_partition" "current" {}</code> and referencing it via <code>data.aws_partition.current.partition</code>.</li>
<li>
<p><strong>Uses Builtin ARN Check Functions</strong>: Tests should use available ARN check functions to validate ARN attribute values in the Terraform state over <code>resource.TestCheckResourceAttrSet()</code> and <code>resource.TestMatchResourceAttr()</code>:</p>
<ul>
<li><code>acctest.CheckResourceAttrRegionalARN()</code> verifies that an ARN matches the account ID and region of the test execution with an exact resource value</li>
<li><code>acctest.MatchResourceAttrRegionalARN()</code> verifies that an ARN matches the account ID and region of the test execution with a regular expression of the resource value</li>
<li><code>acctest.CheckResourceAttrGlobalARN()</code> verifies that an ARN matches the account ID of the test execution with an exact resource value</li>
<li><code>acctest.MatchResourceAttrGlobalARN()</code> verifies that an ARN matches the account ID of the test execution with a regular expression of the resource value</li>
<li><code>acctest.CheckResourceAttrRegionalARNNoAccount()</code> verifies that an ARN has no account ID and matches the current region of the test execution with an exact resource value</li>
<li><code>acctest.CheckResourceAttrGlobalARNNoAccount()</code> verifies that an ARN has no account ID and matches an exact resource value</li>
<li><code>acctest.CheckResourceAttrRegionalARNAccountID()</code> verifies that an ARN matches a specific account ID and the current region of the test execution with an exact resource value</li>
<li><code>acctest.CheckResourceAttrGlobalARNAccountID()</code> verifies that an ARN matches a specific account ID with an exact resource value</li>
</ul>
</li>
</ul>
<p>Here's an example of using <code>aws_partition</code> and <code>data.aws_partition.current.partition</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_partition&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:${data.aws_partition.current.partition}:iam::aws:policy/service-role/AmazonRDSEnhancedMonitoringRole&quot;</span>
<span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.test.name</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-region">Hardcoded Region<a class="headerlink" href="#hardcoded-region" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses aws_region Data Source</strong>: Any hardcoded AWS Region configuration, e.g., <code>us-west-2</code>, should be replaced with the <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region"><code>aws_region</code> data source</a>. A common pattern is declaring <code>data "aws_region" "current" {}</code> and referencing it via <code>data.aws_region.current.region</code></li>
</ul>
<p>Here's an example of using <code>aws_region</code> and <code>data.aws_region.current.region</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_region&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_zone&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">vpc</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">vpc_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_vpc.test.id</span>
<span class="w">    </span><span class="na">vpc_region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_region.current.region</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-spot-price">Hardcoded Spot Price<a class="headerlink" href="#hardcoded-spot-price" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses aws_ec2_spot_price Data Source</strong>: Any hardcoded spot prices, e.g., <code>0.05</code>, should be replaced with the <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ec2_spot_price"><code>aws_ec2_spot_price</code> data source</a>. A common pattern is declaring <code>data "aws_ec2_spot_price" "current" {}</code> and referencing it via <code>data.aws_ec2_spot_price.current.spot_price</code>.</li>
</ul>
<p>Here's an example of using <code>aws_ec2_spot_price</code> and <code>data.aws_ec2_spot_price.current.spot_price</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_ec2_spot_price&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;t3.medium&quot;</span>

<span class="w">  </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;product-description&quot;</span>
<span class="w">    </span><span class="na">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Linux/UNIX&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_spot_fleet_request&quot;</span><span class="w"> </span><span class="nv">&quot;test&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">spot_price</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_ec2_spot_price.current.spot_price</span>
<span class="w">  </span><span class="na">target_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-ssh-keys">Hardcoded SSH Keys<a class="headerlink" href="#hardcoded-ssh-keys" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses acctest.RandSSHKeyPair() or RandSSHKeyPairSize() Functions</strong>: Any hardcoded SSH keys should be replaced with random SSH keys generated by either the acceptance testing framework's function <a href="https://pkg.go.dev/github.com/hashicorp/terraform-plugin-sdk/helper/acctest#RandSSHKeyPair"><code>RandSSHKeyPair()</code></a> or the provider function <code>RandSSHKeyPairSize()</code>. <code>RandSSHKeyPair()</code> generates 1024-bit keys.</li>
</ul>
<p>Here's an example using <code>aws_key_pair</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccKeyPair_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">...</span>

<span class="w">    </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>
<span class="w">    </span><span class="nx">publicKey</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">RandSSHKeyPair</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">DefaultEmailAddress</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;generating random SSH key: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccKeyPairConfig</span><span class="p">(</span><span class="nx">rName</span><span class="p">,</span><span class="w"> </span><span class="nx">publicKey</span><span class="p">),</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">testAccKeyPairConfig</span><span class="p">(</span><span class="nx">rName</span><span class="p">,</span><span class="w"> </span><span class="nx">publicKey</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">`</span>
<span class="s">resource &quot;aws_key_pair&quot; &quot;test&quot; {</span>
<span class="s">  key_name   = %[1]q</span>
<span class="s">  public_key = %[2]q</span>
<span class="s">}</span>
<span class="s">`</span><span class="p">,</span><span class="w"> </span><span class="nx">rName</span><span class="p">,</span><span class="w"> </span><span class="nx">publicKey</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="hardcoded-email-addresses">Hardcoded Email Addresses<a class="headerlink" href="#hardcoded-email-addresses" title="Permanent link">#</a></h4>
<ul>
<li><strong>Uses either acctest.DefaultEmailAddress Constant or acctest.RandomEmailAddress() Function</strong>: Any hardcoded email addresses should replaced with either the constant <code>acctest.DefaultEmailAddress</code> or the function <code>acctest.RandomEmailAddress()</code>.</li>
</ul>
<p>Using <code>acctest.DefaultEmailAddress</code> is preferred when using a single email address in an acceptance test.</p>
<p>Here's an example using <code>acctest.DefaultEmailAddress</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccSNSTopicSubscription_email</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="nx">rName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sdkacctest</span><span class="p">.</span><span class="nx">RandomWithPrefix</span><span class="p">(</span><span class="nx">acctest</span><span class="p">.</span><span class="nx">ResourcePrefix</span><span class="p">)</span>

<span class="w">    </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccTopicSubscriptionEmailConfig</span><span class="p">(</span><span class="nx">rName</span><span class="p">,</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">DefaultEmailAddress</span><span class="p">),</span>
<span class="w">                </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">                    </span><span class="o">...</span>
<span class="w">                    </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">DefaultEmailAddress</span><span class="p">),</span>
<span class="w">                </span><span class="p">),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>Here's an example using <code>acctest.RandomEmailAddress()</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestAccPinpointEmailChannel_basic</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="nx">domain</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">RandomDomainName</span><span class="p">()</span>
<span class="w">    </span><span class="nx">address1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">RandomEmailAddress</span><span class="p">(</span><span class="nx">domain</span><span class="p">)</span>
<span class="w">    </span><span class="nx">address2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">acctest</span><span class="p">.</span><span class="nx">RandomEmailAddress</span><span class="p">(</span><span class="nx">domain</span><span class="p">)</span>

<span class="w">    </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ParallelTest</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCase</span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="nx">Steps</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestStep</span><span class="p">{</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccEmailChannelConfig_FromAddress</span><span class="p">(</span><span class="nx">domain</span><span class="p">,</span><span class="w"> </span><span class="nx">address1</span><span class="p">),</span>
<span class="w">                </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">                    </span><span class="o">...</span>
<span class="w">                    </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;from_address&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">address1</span><span class="p">),</span>
<span class="w">                </span><span class="p">),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nx">Config</span><span class="p">:</span><span class="w"> </span><span class="nx">testAccEmailChannelConfig_FromAddress</span><span class="p">(</span><span class="nx">domain</span><span class="p">,</span><span class="w"> </span><span class="nx">address2</span><span class="p">),</span>
<span class="w">                </span><span class="nx">Check</span><span class="p">:</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">ComposeTestCheckFunc</span><span class="p">(</span>
<span class="w">                    </span><span class="o">...</span>
<span class="w">                    </span><span class="nx">resource</span><span class="p">.</span><span class="nx">TestCheckResourceAttr</span><span class="p">(</span><span class="nx">resourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;from_address&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">address2</span><span class="p">),</span>
<span class="w">                </span><span class="p">),</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      HashiCorp
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>