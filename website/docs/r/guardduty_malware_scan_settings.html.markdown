---
subcategory: "GuardDuty"
layout: "aws"
page_title: "AWS: aws_guardduty_malware_scan_settings"
description: |-
  Provides a resource to manage the Malware Scan Settings of a GuardDuty detector
---

# Resource: aws_guardduty_malware_scan_settings

Provides a resource to manage the Malware Scan Settings of a GuardDuty detector.

## Example Usage

```terraform
resource "aws_guardduty_malware_scan_settings" "example" {
  detector_id = aws_guardduty_detector.example.id

  ebs_snapshot_preservation = "RETENTION_WITH_FINDING"

  scan_resource_criteria {
    include {
      ec2_instance_tag {
        map_equals {
          key   = "key1"
          value = "value1"
        }

        map_equals {
          key   = "key2"
          value = "value2"
        }
      }
    }
  }
}
```

## Argument Reference

This resource supports the following arguments:

* `detector_id` - (Required, Forces new resource) The identifier of the GuardDuty detector.
* `ebs_snapshot_preservation` - (Required) The [snapshot retention](https://docs.aws.amazon.com/guardduty/latest/ug/malware-protection-customizations.html#mp-snapshots-retention) setting for scanned EBS volumes. Valid values are `NO_RETENTION` and `RETENTION_WITH_FINDING`.
* `scan_resource_criteria` - (Optional) The [criteria](https://docs.aws.amazon.com/guardduty/latest/ug/malware-protection-customizations.html#mp-scan-options) to be used in the filter when selecting resources to scan. See [`scan_resource_criteria`](#scan_resource_criteria-argument-reference) below.

### `scan_resource_criteria` argument reference

* `exclude` - (Optional) The conditions that when matched will prevent a malware scan for a certain resource. Conflicts with `include`. See [`exclude`](#exclude-and-include-argument-reference) below.
* `include` - (Optional) The conditions that when matched will allow a malware scan for a certain resource. Conflicts with `exclude`. See [`include`](#exclude-and-include-argument-reference) below.

### `exclude` and `include` argument reference

* `ec2_instance_tag` - (Required) The EC2 instance tag conditions for a malware scan. See [`ec2_instance_tag`](#ec2_instance_tag-argument-reference) below.

### `ec2_instance_tag` argument reference

* `map_equals` - (Required) Represents one or more [map equals conditions](https://docs.aws.amazon.com/guardduty/latest/APIReference/API_ScanCondition.html) to be applied to EC2 instance tags for triggering a malware scan. Multiple conditions are logically OR-ed together. See [`map_equals`](#map_equals-argument-reference) below.

### `map_equals` argument reference

* `key` - (Required) Represents the key in the map condition.
* `value` - (Optional) Represents value in the map condition. If not specified, only the key will be matched.

## Attribute Reference

This resource exports the following attributes in addition to the arguments above:

* `id` - The detector ID that the malware scan settings applies to.

## Import

In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import malware scan settings using their GuardDuty detector IDs. For example:

```terraform
import {
  to = aws_guardduty_malware_scan_settings.example
  id = "1234567890abcdef0123"
}
```

Using `terraform import`, import malware scan settings using their GuardDuty dectector IDs. For example:

```console
% terraform import aws_guardduty_malware_scan_settings.example 1234567890abcdef0123
```
