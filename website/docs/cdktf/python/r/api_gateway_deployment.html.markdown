---
subcategory: "API Gateway"
layout: "aws"
page_title: "AWS: aws_api_gateway_deployment"
description: |-
  Manages an API Gateway REST Deployment.
---


<!-- Please do not edit this file, it is generated. -->
# Resource: aws_api_gateway_deployment

Manages an API Gateway REST Deployment. A deployment is a snapshot of the REST API configuration. The deployment can then be published to callable endpoints via the [`aws_api_gateway_stage` resource](api_gateway_stage.html) and optionally managed further with the [`aws_api_gateway_base_path_mapping` resource](api_gateway_base_path_mapping.html), [`aws_api_gateway_domain_name` resource](api_gateway_domain_name.html), and [`aws_api_method_settings` resource](api_gateway_method_settings.html). For more information, see the [API Gateway Developer Guide](https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-deploy-api.html).

To properly capture all REST API configuration in a deployment, this resource must have dependencies on all prior Terraform resources that manage resources/paths, methods, integrations, etc.

* For REST APIs that are configured via OpenAPI specification ([`aws_api_gateway_rest_api` resource](api_gateway_rest_api.html) `body` argument), no special dependency setup is needed beyond referencing the  `id` attribute of that resource unless additional Terraform resources have further customized the REST API.
* When the REST API configuration involves other Terraform resources ([`aws_api_gateway_integration` resource](api_gateway_integration.html), etc.), the dependency setup can be done with implicit resource references in the `triggers` argument or explicit resource references using the [resource `depends_on` meta-argument](https://www.terraform.io/docs/configuration/meta-arguments/depends_on.html). The `triggers` argument should be preferred over `depends_on`, since `depends_on` can only capture dependency ordering and will not cause the resource to recreate (redeploy the REST API) with upstream configuration changes.

!> **WARNING:** We recommend using the [`aws_api_gateway_stage` resource](api_gateway_stage.html) instead of managing an API Gateway Stage via the `stage_name` argument of this resource. When this resource is recreated (REST API redeployment) with the `stage_name` configured, the stage is deleted and recreated. This will cause a temporary service interruption, increase Terraform plan differences, and can require a second Terraform apply to recreate any downstream stage configuration such as associated `aws_api_method_settings` resources.

~> **NOTE:** Enable the [resource `lifecycle` configuration block `create_before_destroy` argument](https://www.terraform.io/language/meta-arguments/lifecycle#create_before_destroy) in this resource configuration to properly order redeployments in Terraform. Without enabling `create_before_destroy`, API Gateway can return errors such as `BadRequestException: Active stages pointing to this deployment must be moved or deleted` on recreation.

## Example Usage

### OpenAPI Specification

An end-to-end example of a REST API configured with OpenAPI can be found in the [`/examples/api-gateway-rest-api-openapi` directory within the GitHub repository](https://github.com/hashicorp/terraform-provider-aws/tree/main/examples/api-gateway-rest-api-openapi).

```terraform
resource "aws_api_gateway_rest_api" "example" {
  body = jsonencode({
    openapi = "3.0.1"
    info = {
      title   = "example"
      version = "1.0"
    }
    paths = {
      "/path1" = {
        get = {
          x-amazon-apigateway-integration = {
            httpMethod           = "GET"
            payloadFormatVersion = "1.0"
            type                 = "HTTP_PROXY"
            uri                  = "https://ip-ranges.amazonaws.com/ip-ranges.json"
          }
        }
      }
    }
  })

  name = "example"
}

resource "aws_api_gateway_deployment" "example" {
  rest_api_id = aws_api_gateway_rest_api.example.id

  triggers = {
    redeployment = sha1(jsonencode(aws_api_gateway_rest_api.example.body))
  }

  lifecycle {
    create_before_destroy = true
  }
}

resource "aws_api_gateway_stage" "example" {
  deployment_id = aws_api_gateway_deployment.example.id
  rest_api_id   = aws_api_gateway_rest_api.example.id
  stage_name    = "example"
}
```

### Terraform Resources

```python
# DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
from cdktf import TerraformResourceLifecycle
from constructs import Construct
from cdktf import Token, Fn, TerraformStack
#
# Provider bindings are generated by running `cdktf get`.
# See https://cdk.tf/provider-generation for more details.
#
from imports.aws.api_gateway_deployment import ApiGatewayDeployment
from imports.aws.api_gateway_integration import ApiGatewayIntegration
from imports.aws.api_gateway_method import ApiGatewayMethod
from imports.aws.api_gateway_resource import ApiGatewayResource
from imports.aws.api_gateway_rest_api import ApiGatewayRestApi
from imports.aws.api_gateway_stage import ApiGatewayStage
class MyConvertedCode(TerraformStack):
    def __init__(self, scope, name):
        super().__init__(scope, name)
        example = ApiGatewayRestApi(self, "example",
            name="example"
        )
        aws_api_gateway_resource_example = ApiGatewayResource(self, "example_1",
            parent_id=example.root_resource_id,
            path_part="example",
            rest_api_id=example.id
        )
        # This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.
        aws_api_gateway_resource_example.override_logical_id("example")
        aws_api_gateway_method_example = ApiGatewayMethod(self, "example_2",
            authorization="NONE",
            http_method="GET",
            resource_id=Token.as_string(aws_api_gateway_resource_example.id),
            rest_api_id=example.id
        )
        # This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.
        aws_api_gateway_method_example.override_logical_id("example")
        aws_api_gateway_integration_example = ApiGatewayIntegration(self, "example_3",
            http_method=Token.as_string(aws_api_gateway_method_example.http_method),
            resource_id=Token.as_string(aws_api_gateway_resource_example.id),
            rest_api_id=example.id,
            type="MOCK"
        )
        # This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.
        aws_api_gateway_integration_example.override_logical_id("example")
        aws_api_gateway_deployment_example = ApiGatewayDeployment(self, "example_4",
            lifecycle=TerraformResourceLifecycle(
                create_before_destroy=True
            ),
            rest_api_id=example.id,
            triggers={
                "redeployment": Token.as_string(
                    Fn.sha1(
                        Token.as_string(
                            Fn.jsonencode([aws_api_gateway_resource_example.id, aws_api_gateway_method_example.id, aws_api_gateway_integration_example.id
                            ]))))
            }
        )
        # This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.
        aws_api_gateway_deployment_example.override_logical_id("example")
        aws_api_gateway_stage_example = ApiGatewayStage(self, "example_5",
            deployment_id=Token.as_string(aws_api_gateway_deployment_example.id),
            rest_api_id=example.id,
            stage_name="example"
        )
        # This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.
        aws_api_gateway_stage_example.override_logical_id("example")
```

## Argument Reference

This resource supports the following arguments:

* `rest_api_id` - (Required) REST API identifier.
* `description` - (Optional) Description of the deployment
* `stage_name` - (Optional) Name of the stage to create with this deployment. If the specified stage already exists, it will be updated to point to the new deployment. We recommend using the [`aws_api_gateway_stage` resource](api_gateway_stage.html) instead to manage stages.
* `stage_description` - (Optional) Description to set on the stage managed by the `stage_name` argument.
* `triggers` - (Optional) Map of arbitrary keys and values that, when changed, will trigger a redeployment. To force a redeployment without changing these keys/values, use the [`-replace` option](https://developer.hashicorp.com/terraform/cli/commands/plan#replace-address) with `terraform plan` or `terraform apply`.
* `variables` - (Optional) Map to set on the stage managed by the `stage_name` argument.

## Attribute Reference

This resource exports the following attributes in addition to the arguments above:

* `id` - ID of the deployment
* `invoke_url` - URL to invoke the API pointing to the stage,
  e.g., `https://z4675bid1j.execute-api.eu-west-2.amazonaws.com/prod`
* `execution_arn` - Execution ARN to be used in [`lambda_permission`](/docs/providers/aws/r/lambda_permission.html)'s `source_arn`
  when allowing API Gateway to invoke a Lambda function,
  e.g., `arn:aws:execute-api:eu-west-2:123456789012:z4675bid1j/prod`
* `created_date` - Creation date of the deployment

## Import

In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import `aws_api_gateway_deployment` using `REST-API-ID/DEPLOYMENT-ID`. For example:

```python
# DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
from constructs import Construct
from cdktf import TerraformStack
class MyConvertedCode(TerraformStack):
    def __init__(self, scope, name):
        super().__init__(scope, name)
```

Using `terraform import`, import `aws_api_gateway_deployment` using `REST-API-ID/DEPLOYMENT-ID`. For example:

```console
% terraform import aws_api_gateway_deployment.example aabbccddee/1122334
```

The `stage_name`, `stage_description`, and `variables` arguments cannot be imported. Use the [`aws_api_gateway_stage` resource](api_gateway_stage.html) to import and manage stages.

The `triggers` argument cannot be imported.

<!-- cache-key: cdktf-0.19.0 input-a6bba7a5df573767f5e0da500df7a421964740e00b416a999a065c5b3ab27982 -->