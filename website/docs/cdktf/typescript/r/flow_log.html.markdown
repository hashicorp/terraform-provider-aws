---
subcategory: "VPC (Virtual Private Cloud)"
layout: "aws"
page_title: "AWS: aws_flow_log"
description: |-
  Provides a VPC/Subnet/ENI Flow Log
---


<!-- Please do not edit this file, it is generated. -->
# Resource: aws_flow_log

Provides a VPC/Subnet/ENI/Transit Gateway/Transit Gateway Attachment Flow Log to capture IP traffic for a specific network
interface, subnet, or VPC. Logs are sent to a CloudWatch Log Group, a S3 Bucket, or Amazon Data Firehose

## Example Usage

### CloudWatch Logging

```typescript
// DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
import { Construct } from "constructs";
import { Token, TerraformStack } from "cdktf";
/*
 * Provider bindings are generated by running `cdktf get`.
 * See https://cdk.tf/provider-generation for more details.
 */
import { CloudwatchLogGroup } from "./.gen/providers/aws/cloudwatch-log-group";
import { DataAwsIamPolicyDocument } from "./.gen/providers/aws/data-aws-iam-policy-document";
import { FlowLog } from "./.gen/providers/aws/flow-log";
import { IamRole } from "./.gen/providers/aws/iam-role";
import { IamRolePolicy } from "./.gen/providers/aws/iam-role-policy";
class MyConvertedCode extends TerraformStack {
  constructor(scope: Construct, name: string) {
    super(scope, name);
    const example = new CloudwatchLogGroup(this, "example", {
      name: "example",
    });
    const assumeRole = new DataAwsIamPolicyDocument(this, "assume_role", {
      statement: [
        {
          actions: ["sts:AssumeRole"],
          effect: "Allow",
          principals: [
            {
              identifiers: ["vpc-flow-logs.amazonaws.com"],
              type: "Service",
            },
          ],
        },
      ],
    });
    const dataAwsIamPolicyDocumentExample = new DataAwsIamPolicyDocument(
      this,
      "example_2",
      {
        statement: [
          {
            actions: [
              "logs:CreateLogGroup",
              "logs:CreateLogStream",
              "logs:PutLogEvents",
              "logs:DescribeLogGroups",
              "logs:DescribeLogStreams",
            ],
            effect: "Allow",
            resources: ["*"],
          },
        ],
      }
    );
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    dataAwsIamPolicyDocumentExample.overrideLogicalId("example");
    const awsIamRoleExample = new IamRole(this, "example_3", {
      assumeRolePolicy: Token.asString(assumeRole.json),
      name: "example",
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsIamRoleExample.overrideLogicalId("example");
    const awsIamRolePolicyExample = new IamRolePolicy(this, "example_4", {
      name: "example",
      policy: Token.asString(dataAwsIamPolicyDocumentExample.json),
      role: Token.asString(awsIamRoleExample.id),
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsIamRolePolicyExample.overrideLogicalId("example");
    const awsFlowLogExample = new FlowLog(this, "example_5", {
      iamRoleArn: Token.asString(awsIamRoleExample.arn),
      logDestination: example.arn,
      trafficType: "ALL",
      vpcId: Token.asString(awsVpcExample.id),
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsFlowLogExample.overrideLogicalId("example");
  }
}

```

### Amazon Data Firehose logging

```typescript
// DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
import { Construct } from "constructs";
import { Token, TerraformStack } from "cdktf";
/*
 * Provider bindings are generated by running `cdktf get`.
 * See https://cdk.tf/provider-generation for more details.
 */
import { DataAwsIamPolicyDocument } from "./.gen/providers/aws/data-aws-iam-policy-document";
import { FlowLog } from "./.gen/providers/aws/flow-log";
import { IamRole } from "./.gen/providers/aws/iam-role";
import { IamRolePolicy } from "./.gen/providers/aws/iam-role-policy";
import { KinesisFirehoseDeliveryStream } from "./.gen/providers/aws/kinesis-firehose-delivery-stream";
import { S3Bucket } from "./.gen/providers/aws/s3-bucket";
import { S3BucketAcl } from "./.gen/providers/aws/s3-bucket-acl";
class MyConvertedCode extends TerraformStack {
  constructor(scope: Construct, name: string) {
    super(scope, name);
    const example = new S3Bucket(this, "example", {
      bucket: "example",
    });
    const awsS3BucketAclExample = new S3BucketAcl(this, "example_1", {
      acl: "private",
      bucket: example.id,
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsS3BucketAclExample.overrideLogicalId("example");
    const assumeRole = new DataAwsIamPolicyDocument(this, "assume_role", {
      statement: [
        {
          actions: ["sts:AssumeRole"],
          effect: "Allow",
          principals: [
            {
              identifiers: ["firehose.amazonaws.com"],
              type: "Service",
            },
          ],
        },
      ],
    });
    const dataAwsIamPolicyDocumentExample = new DataAwsIamPolicyDocument(
      this,
      "example_3",
      {
        actions: [
          "logs:CreateLogDelivery",
          "logs:DeleteLogDelivery",
          "logs:ListLogDeliveries",
          "logs:GetLogDelivery",
          "firehose:TagDeliveryStream",
        ],
        effect: "Allow",
        resources: ["*"],
      }
    );
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    dataAwsIamPolicyDocumentExample.overrideLogicalId("example");
    const awsIamRoleExample = new IamRole(this, "example_4", {
      assumeRolePolicy: Token.asString(assumeRole.json),
      name: "firehose_test_role",
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsIamRoleExample.overrideLogicalId("example");
    const awsIamRolePolicyExample = new IamRolePolicy(this, "example_5", {
      name: "test",
      policy: Token.asString(dataAwsIamPolicyDocumentExample.json),
      role: Token.asString(awsIamRoleExample.id),
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsIamRolePolicyExample.overrideLogicalId("example");
    const awsKinesisFirehoseDeliveryStreamExample =
      new KinesisFirehoseDeliveryStream(this, "example_6", {
        destination: "extended_s3",
        extendedS3Configuration: {
          bucketArn: example.arn,
          roleArn: Token.asString(awsIamRoleExample.arn),
        },
        name: "kinesis_firehose_test",
        tags: {
          LogDeliveryEnabled: "true",
        },
      });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsKinesisFirehoseDeliveryStreamExample.overrideLogicalId("example");
    const awsFlowLogExample = new FlowLog(this, "example_7", {
      logDestination: Token.asString(
        awsKinesisFirehoseDeliveryStreamExample.arn
      ),
      logDestinationType: "kinesis-data-firehose",
      trafficType: "ALL",
      vpcId: Token.asString(awsVpcExample.id),
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsFlowLogExample.overrideLogicalId("example");
  }
}

```

### S3 Logging

```typescript
// DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
import { Construct } from "constructs";
import { Token, TerraformStack } from "cdktf";
/*
 * Provider bindings are generated by running `cdktf get`.
 * See https://cdk.tf/provider-generation for more details.
 */
import { FlowLog } from "./.gen/providers/aws/flow-log";
import { S3Bucket } from "./.gen/providers/aws/s3-bucket";
class MyConvertedCode extends TerraformStack {
  constructor(scope: Construct, name: string) {
    super(scope, name);
    const example = new S3Bucket(this, "example", {
      bucket: "example",
    });
    const awsFlowLogExample = new FlowLog(this, "example_1", {
      logDestination: example.arn,
      logDestinationType: "s3",
      trafficType: "ALL",
      vpcId: Token.asString(awsVpcExample.id),
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsFlowLogExample.overrideLogicalId("example");
  }
}

```

### S3 Logging in Apache Parquet format with per-hour partitions

```typescript
// DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
import { Construct } from "constructs";
import { Token, TerraformStack } from "cdktf";
/*
 * Provider bindings are generated by running `cdktf get`.
 * See https://cdk.tf/provider-generation for more details.
 */
import { FlowLog } from "./.gen/providers/aws/flow-log";
import { S3Bucket } from "./.gen/providers/aws/s3-bucket";
class MyConvertedCode extends TerraformStack {
  constructor(scope: Construct, name: string) {
    super(scope, name);
    const example = new S3Bucket(this, "example", {
      bucket: "example",
    });
    const awsFlowLogExample = new FlowLog(this, "example_1", {
      destinationOptions: {
        fileFormat: "parquet",
        perHourPartition: true,
      },
      logDestination: example.arn,
      logDestinationType: "s3",
      trafficType: "ALL",
      vpcId: Token.asString(awsVpcExample.id),
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsFlowLogExample.overrideLogicalId("example");
  }
}

```

### Cross-Account Amazon Data Firehose Logging

The following example shows how to set up a flow log in one AWS account (source) that sends logs to an Amazon Data Firehose delivery stream in another AWS account (destination).
See the [AWS Documentation](https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs-firehose.html).

```typescript
// DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
import { Construct } from "constructs";
import { Token, TerraformStack } from "cdktf";
/*
 * Provider bindings are generated by running `cdktf get`.
 * See https://cdk.tf/provider-generation for more details.
 */
import { DataAwsIamPolicyDocument } from "./.gen/providers/aws/data-aws-iam-policy-document";
import { FlowLog } from "./.gen/providers/aws/flow-log";
import { IamRole } from "./.gen/providers/aws/iam-role";
import { IamRolePolicy } from "./.gen/providers/aws/iam-role-policy";
import { KinesisFirehoseDeliveryStream } from "./.gen/providers/aws/kinesis-firehose-delivery-stream";
import { AwsProvider } from "./.gen/providers/aws/provider";
import { Vpc } from "./.gen/providers/aws/vpc";
interface MyConfig {
  destination: any;
  name: any;
}
class MyConvertedCode extends TerraformStack {
  constructor(scope: Construct, name: string, config: MyConfig) {
    super(scope, name);
    new AwsProvider(this, "aws", {
      profile: "admin-src",
    });
    const destinationAccount = new AwsProvider(this, "aws_1", {
      alias: "destination_account",
      profile: "admin-dst",
    });
    const dst = new KinesisFirehoseDeliveryStream(this, "dst", {
      provider: destinationAccount,
      tags: {
        LogDeliveryEnabled: "true",
      },
      destination: config.destination,
      name: config.name,
    });
    const src = new Vpc(this, "src", {});
    const dstRolePolicy = new DataAwsIamPolicyDocument(
      this,
      "dst_role_policy",
      {
        statement: [
          {
            actions: [
              "iam:CreateServiceLinkedRole",
              "firehose:TagDeliveryStream",
            ],
            effect: "Allow",
            resources: ["*"],
          },
        ],
      }
    );
    const srcAssumeRolePolicy = new DataAwsIamPolicyDocument(
      this,
      "src_assume_role_policy",
      {
        statement: [
          {
            actions: ["sts:AssumeRole"],
            effect: "Allow",
            principals: [
              {
                identifiers: ["delivery.logs.amazonaws.com"],
                type: "Service",
              },
            ],
          },
        ],
      }
    );
    const awsIamRoleSrc = new IamRole(this, "src_6", {
      assumeRolePolicy: Token.asString(srcAssumeRolePolicy.json),
      name: "tf-example-mySourceRole",
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsIamRoleSrc.overrideLogicalId("src");
    const dstAssumeRolePolicy = new DataAwsIamPolicyDocument(
      this,
      "dst_assume_role_policy",
      {
        statement: [
          {
            actions: ["sts:AssumeRole"],
            effect: "Allow",
            principals: [
              {
                identifiers: [Token.asString(awsIamRoleSrc.arn)],
                type: "AWS",
              },
            ],
          },
        ],
      }
    );
    const awsIamRoleDst = new IamRole(this, "dst_8", {
      assumeRolePolicy: Token.asString(dstAssumeRolePolicy.json),
      name: "AWSLogDeliveryFirehoseCrossAccountRole",
      provider: destinationAccount,
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsIamRoleDst.overrideLogicalId("dst");
    const awsIamRolePolicyDst = new IamRolePolicy(this, "dst_9", {
      name: "AWSLogDeliveryFirehoseCrossAccountRolePolicy",
      policy: Token.asString(dstRolePolicy.json),
      provider: destinationAccount,
      role: Token.asString(awsIamRoleDst.name),
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsIamRolePolicyDst.overrideLogicalId("dst");
    const srcRolePolicy = new DataAwsIamPolicyDocument(
      this,
      "src_role_policy",
      {
        statement: [
          {
            actions: ["iam:PassRole"],
            condition: [
              {
                test: "StringEquals",
                values: ["delivery.logs.amazonaws.com"],
                variable: "iam:PassedToService",
              },
              {
                test: "StringLike",
                values: [src.arn],
                variable: "iam:AssociatedResourceARN",
              },
            ],
            effect: "Allow",
            resources: [Token.asString(awsIamRoleSrc.arn)],
          },
          {
            actions: [
              "logs:CreateLogDelivery",
              "logs:DeleteLogDelivery",
              "logs:ListLogDeliveries",
              "logs:GetLogDelivery",
            ],
            effect: "Allow",
            resources: ["*"],
          },
          {
            actions: ["sts:AssumeRole"],
            effect: "Allow",
            resources: [Token.asString(awsIamRoleDst.arn)],
          },
        ],
      }
    );
    const awsFlowLogSrc = new FlowLog(this, "src_11", {
      deliverCrossAccountRole: Token.asString(awsIamRoleDst.arn),
      iamRoleArn: Token.asString(awsIamRoleSrc.arn),
      logDestination: dst.arn,
      logDestinationType: "kinesis-data-firehose",
      trafficType: "ALL",
      vpcId: src.id,
    });
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    awsFlowLogSrc.overrideLogicalId("src");
    new IamRolePolicy(this, "src_policy", {
      name: "tf-example-mySourceRolePolicy",
      policy: Token.asString(srcRolePolicy.json),
      role: Token.asString(awsIamRoleSrc.name),
    });
  }
}

```

## Argument Reference

This resource supports the following arguments:

* `region` - (Optional) Region where this resource will be [managed](https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints). Defaults to the Region set in the [provider configuration](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#aws-configuration-reference).
* `trafficType` - (Required) The type of traffic to capture. Valid values: `ACCEPT`,`REJECT`, `ALL`.
* `deliverCrossAccountRole` - (Optional) ARN of the IAM role in the destination account used for cross-account delivery of flow logs.
* `eniId` - (Optional) Elastic Network Interface ID to attach to.
* `iamRoleArn` - (Optional) ARN of the IAM role used to post flow logs. Corresponds to `DeliverLogsPermissionArn` in the [AWS API](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateFlowLogs.html).
* `logDestinationType` - (Optional) Logging destination type. Valid values: `cloud-watch-logs`, `s3`, `kinesis-data-firehose`. Default: `cloud-watch-logs`.
* `logDestination` - (Optional) ARN of the logging destination.
* `subnetId` - (Optional) Subnet ID to attach to.
* `transitGatewayId` - (Optional) Transit Gateway ID to attach to.
* `transitGatewayAttachmentId` - (Optional) Transit Gateway Attachment ID to attach to.
* `vpcId` - (Optional) VPC ID to attach to.
* `logFormat` - (Optional) The fields to include in the flow log record. Accepted format example: `"$${interface-id} $${srcaddr} $${dstaddr} $${srcport} $${dstport}"`.
* `maxAggregationInterval` - (Optional) The maximum interval of time during which a flow of packets is captured and aggregated into a flow log record.
  Valid Values: `60` seconds (1 minute) or `600` seconds (10 minutes). Default: `600`.
  When `transitGatewayId` or `transitGatewayAttachmentId` is specified, `maxAggregationInterval` *must* be 60 seconds (1 minute).
* `destinationOptions` - (Optional) Describes the destination options for a flow log. More details below.
* `tags` - (Optional) Key-value map of resource tags. If configured with a provider [`defaultTags` configuration block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#default_tags-configuration-block) present, tags with matching keys will overwrite those defined at the provider-level.

~> **NOTE:** One of `eniId`, `subnetId`, `transitGatewayId`, `transitGatewayAttachmentId`, or `vpcId` must be specified.

### destination_options

Describes the destination options for a flow log.

* `fileFormat` - (Optional) File format for the flow log. Default value: `plain-text`. Valid values: `plain-text`, `parquet`.
* `hiveCompatiblePartitions` - (Optional) Indicates whether to use Hive-compatible prefixes for flow logs stored in Amazon S3. Default value: `false`.
* `perHourPartition` - (Optional) Indicates whether to partition the flow log per hour. This reduces the cost and response time for queries. Default value: `false`.

## Attribute Reference

This resource exports the following attributes in addition to the arguments above:

* `id` - Flow Log ID.
* `arn` - ARN of the Flow Log.
* `tagsAll` - A map of tags assigned to the resource, including those inherited from the provider [`defaultTags` configuration block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#default_tags-configuration-block).

## Import

In Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import Flow Logs using the `id`. For example:

```typescript
// DO NOT EDIT. Code generated by 'cdktf convert' - Please report bugs at https://cdk.tf/bug
import { Construct } from "constructs";
import { TerraformStack } from "cdktf";
/*
 * Provider bindings are generated by running `cdktf get`.
 * See https://cdk.tf/provider-generation for more details.
 */
import { FlowLog } from "./.gen/providers/aws/flow-log";
class MyConvertedCode extends TerraformStack {
  constructor(scope: Construct, name: string) {
    super(scope, name);
    FlowLog.generateConfigForImport(this, "testFlowLog", "fl-1a2b3c4d");
  }
}

```

Using `terraform import`, import Flow Logs using the `id`. For example:

```console
% terraform import aws_flow_log.test_flow_log fl-1a2b3c4d
```

<!-- cache-key: cdktf-0.20.8 input-b8c66e32aad3fcb0dd6873100a1808546cd0a45dfb7adf7067b7f8cd9f8760a8 -->